<%- include('partials/header') %>

<!-- Page-scoped styles from the original contact page to preserve look-and-feel -->
<style>
  /* Limit scope to contact page wrappers to avoid site-wide impact */
  .contact-page-v2 .wpforms-container .wpforms-field-label,
  .contact-page-v2 .wpforms-container legend.wpforms-field-label { color: var(--bs-white); }

  .contact-page-v2 .wpforms-container input[type="text"],
  .contact-page-v2 .wpforms-container input[type="email"],
  .contact-page-v2 .wpforms-container input[type="tel"],
  .contact-page-v2 .wpforms-container textarea,
  .contact-page-v2 .wpforms-container select {
    border-radius: 8px;
    border-color: var(--brand-blue);
  }

  .contact-page-v2 .wpforms-container input[type="text"]:focus,
  .contact-page-v2 .wpforms-container input[type="email"]:focus,
  .contact-page-v2 .wpforms-container input[type="tel"]:focus,
  .contact-page-v2 .wpforms-container textarea:focus,
  .contact-page-v2 .wpforms-container select:focus {
    border-color: var(--brand-blue);
    box-shadow: 0 0 0 .2rem rgba(11, 94, 142, 0.25);
  }

  /* Force dark text on left hero section overlay */
  .contact-page-v2 .content-wrapper-left.overlay-jade,
  .contact-page-v2 .content-wrapper-left.overlay-jade h1,
  .contact-page-v2 .content-wrapper-left.overlay-jade h2,
  .contact-page-v2 .content-wrapper-left.overlay-jade h3,
  .contact-page-v2 .content-wrapper-left.overlay-jade h4,
  .contact-page-v2 .content-wrapper-left.overlay-jade h5,
  .contact-page-v2 .content-wrapper-left.overlay-jade h6,
  .contact-page-v2 .content-wrapper-left.overlay-jade p,
  .contact-page-v2 .content-wrapper-left.overlay-jade ul,
  .contact-page-v2 .content-wrapper-left.overlay-jade li,
  .contact-page-v2 .content-wrapper-left.overlay-jade strong,
  .contact-page-v2 .content-wrapper-left.overlay-jade a {
    color: #000 !important;
  }

  .contact-page-v2 .wpforms-submit,
  .contact-page-v2 button[type="submit"],
  .contact-page-v2 .wpforms-page-button {
    background-color: var(--brand-yellow) !important; /* Washology lime */
    border-color: var(--brand-yellow) !important;
    color: var(--brand-blue) !important; /* blue font */
    border-radius: 8px;
    padding: 0.6rem 1.25rem;
  }
  .contact-page-v2 .wpforms-submit:hover,
  .contact-page-v2 button[type="submit"]:hover,
  .contact-page-v2 .wpforms-page-button:hover {
    background-color: var(--brand-yellow) !important;
    border-color: var(--brand-yellow) !important;
    color: var(--brand-blue) !important;
    filter: brightness(1.05);
    box-shadow: 0 6px 14px rgba(184, 226, 21, 0.35);
  }

  /* Layout and spacing */
  .contact-page-v2 .wpforms-container { max-width: 720px; margin: 0 auto; }
  .contact-page-v2 .wpforms-container .wpforms-field { margin-bottom: 16px; }
  /* Always stack name fields for full-width inputs */
  .contact-page-v2 .wpforms-container .wpforms-field-row { display: block; }
  .contact-page-v2 .wpforms-container .wpforms-field-row-block { width: 100%; }
  .contact-page-v2 .wpforms-container .wpforms-submit-container { text-align: center; margin-top: 10px; }

  /* Center both form sections containers */
  .contact-page-v2 .content-wrapper-right .inner-wrapper,
  .contact-page-v2 .bottom-form-wrapper .inner-wrapper { max-width: 760px; margin: 0 auto; }

  /* Labels and required indicators */
  .contact-page-v2 .wpforms-container .wpforms-field-label { font-weight: 600; }
  .contact-page-v2 .wpforms-container .wpforms-required-label { color: var(--brand-red); margin-left: 2px; }
  .contact-page-v2 .wpforms-container .wpforms-field-sublabel.after { display: block; margin-top: 6px; font-size: 12px; color: #6c757d; }

  /* Inputs and placeholders */
  .contact-page-v2 .wpforms-container input[type="text"],
  .contact-page-v2 .wpforms-container input[type="email"],
  .contact-page-v2 .wpforms-container input[type="tel"],
  .contact-page-v2 .wpforms-container textarea,
  .contact-page-v2 .wpforms-container select {
    padding: 10px 12px;
    background: #fff;
    outline: none;
    width: 100%;
  }
  .contact-page-v2 .wpforms-container input::placeholder,
  .contact-page-v2 .wpforms-container textarea::placeholder { color: #9aa3ad; opacity: 1; }

  /* Ensure overlay doesn't fully obscure background images on this page */
  .contact-page-v2 .content-wrapper-left.overlay-jade:before,
  .contact-page-v2 .content-wrapper-right.overlay-jade:before {
    background-color: rgba(11, 94, 142, 0.65) !important; /* semi-transparent brand blue */
  }

  /* Error states (compatible with WPForms modern) */
  .contact-page-v2 .wpforms-container .wpforms-error, 
  .contact-page-v2 .wpforms-container .wpforms-field.wpforms-has-error .wpforms-field-label { color: #d63637; }
  .contact-page-v2 .wpforms-container input[aria-invalid="true"],
  .contact-page-v2 .wpforms-container textarea[aria-invalid="true"],
  .contact-page-v2 .wpforms-container select[aria-invalid="true"] {
    border-color: #d63637;
    box-shadow: 0 0 0 .2rem rgba(214, 54, 55, 0.15);
  }

  /* Responsive adjustments */
  @media (max-width: 600px) {
    .contact-page-v2 .wpforms-container { max-width: 100%; padding: 0 12px; }
    .contact-page-v2 .wpforms-container .wpforms-submit-container { text-align: center; }
  }

  /* Center section titles for both form sections */
  .contact-page-v2 .content-wrapper-right .title-wrapper,
  .contact-page-v2 .bottom-form-wrapper .title-wrapper { text-align: center; }

  /* Reviews: only cards are red; section keeps default background */
  .contact-page-v2 .reviews-container .resi-reviews--inner { gap: 16px; }
  .contact-page-v2 .reviews-container .resi-review--inner {
    background: var(--brand-red) !important;
    color: #fff !important;
    border: 0;
    border-radius: 10px;
  }
  .contact-page-v2 .reviews-container .resi-review--inner .resi-review--stars,
  .contact-page-v2 .reviews-container .resi-review--inner .resi-review--author,
  .contact-page-v2 .reviews-container .resi-review--inner p,
  .contact-page-v2 .reviews-container .resi-review--inner h1,
  .contact-page-v2 .reviews-container .resi-review--inner h2,
  .contact-page-v2 .reviews-container .resi-review--inner h3,
  .contact-page-v2 .reviews-container .resi-review--inner h4,
  .contact-page-v2 .reviews-container .resi-review--inner h5,
  .contact-page-v2 .reviews-container .resi-review--inner h6,
  .contact-page-v2 .reviews-container .resi-review--inner a { color: #fff !important; }
</style>

<div id="primary" class="content-area contact-page-v2 contact-page-v2-template">
  <section class="contact-us--hero">
    <div class="container"> 
      <div class="content-upper-wrapper col-sm-12">
        <div class="title-wrapper col-sm-12">
          <h1 style="color: var(--brand-red) !important;"><%= (contact && contact.heroTitle) || 'Book Now' %></h1>
          <div class="subtitle-wrapper">
            <h2 style="color: var(--brand-red) !important;"><%= (contact && contact.heroSubtitle) || 'Free estimates within 24 hours' %></h2>
          </div>
        </div>
      </div>

      <div class="content-bottom-wrapper col-sm-12">
        <% 
          const _rawLeftBg = (contact && contact.leftBg) || '/pictures/Washology/Gemini_Generated_Image_gl6ufrgl6ufrgl6u.png';
          const _leftTrim = (typeof _rawLeftBg === 'string') ? _rawLeftBg.trim() : '';
          const _leftAbs = /^https?:\/\//i.test(_leftTrim);
          const _leftBgUrl = _leftTrim
            ? (_leftAbs ? _leftTrim : ('/' + _leftTrim.replace(/^\/+/, '')))
            : '/pictures/Washology/Gemini_Generated_Image_gl6ufrgl6ufrgl6u.png';
        %>
        <section class="content-wrapper-left col-sm-12 col-md-6 order-md-2" style="background-image: url('<%= _leftBgUrl %>'); background-position: center; background-size: cover; background-repeat: no-repeat;">
          <h3 style="color: white !important;"><%= (contact && contact.leftTitle) || 'Start Your Pool Service' %></h3>
          <h4 style="color: white !important;"><b><%= (contact && contact.leftSubtitle) || 'Crystal-clear water. Stress-free maintenance.' %></b></h4>
          <ul>
            <li style="color: white !important;"><%= (contact && contact.bullet1) || 'WEEKLY SERVICE' %></li>
            <li style="color: white !important;"><%= (contact && contact.bullet2) || 'CHEMICAL BALANCING' %></li>
            <li style="color: white !important;"><%= (contact && contact.bullet3) || 'FILTER CLEANING' %></li>
            <li style="color: white !important;"><%= (contact && contact.bullet4) || 'GREEN POOL CLEANUP' %></li>
            <li style="color: white !important;"><%= (contact && contact.bullet5) || 'EQUIPMENT REPAIRS' %></li>
            <li style="color: white !important;"><%= (contact && contact.bullet6) || 'PUMP & HEATER SERVICE' %></li>
          </ul>
        </section>

  <!-- Page-scoped styles for ZIP suggestions -->
  <style>
    .zip-suggest {
      position: relative;
      z-index: 5;
      margin-top: .25rem;
      border-radius: 12px;
      overflow: hidden;
      background: #fff;
      color: #05132D;
      box-shadow: 0 12px 28px rgba(0,0,0,.25);
    }
    .zip-suggest .item { display: flex; align-items: center; gap: .5rem; padding: .625rem .75rem; cursor: pointer; }
    .zip-suggest .item:hover, .zip-suggest .item[aria-selected="true"] { background: #f2f2f2; }
    .zip-suggest .icon { color: var(--brand-blue); display: inline-flex; }
    .zip-suggest .primary { font-weight: 700; }
    .zip-suggest .secondary { opacity: .85; font-size: .9rem; }
  </style>

        <div class="content-wrapper-right col-sm-12 col-md-6 col-lg-6 order-md-1" style="background: var(--brand-blue);">
          <div class="title-wrapper col-sm-12">
            <h2 style="color: white !important;"><%= (contact && contact.rightTitle) || 'Estimates in 24 Hours or Less' %></h2>
          </div>

          <!-- Accessible contact form preserving original look and CSS targets -->
          <div class="wpforms-container wpforms-container-full">
            <form id="contactForm1" class="wpforms-form" method="post" action="/api/leads">
              <div class="wpforms-field-container">
                <div class="wpforms-field">
                  <label class="wpforms-field-label" for="contact-name" style="color: white !important;">Name <span aria-hidden="true" class="wpforms-required-label">*</span></label>
                  <div class="wpforms-field-row">
                    <div class="wpforms-field-row-block wpforms-one-half">
                      <input type="text" id="contact-name-first" name="firstName" placeholder="First" required autocomplete="given-name" />
                    </div>
                    <div class="wpforms-field-row-block wpforms-one-half">
                      <input type="text" id="contact-name-last" name="lastName" placeholder="Last" required autocomplete="family-name" />
                    </div>
                  </div>
                </div>

                <div class="wpforms-field">
                  <label class="wpforms-field-label" for="contact-phone" style="color: white !important;">Phone <span aria-hidden="true" class="wpforms-required-label">*</span></label>
                  <input type="tel" id="contact-phone" name="phone" inputmode="tel" placeholder="(555) 555-5555" pattern="^\\+?[0-9\\s().-]{7,}$" required autocomplete="tel" />
                </div>

                <div class="wpforms-field">
                  <label class="wpforms-field-label" for="contact-email" style="color: white !important;">Email <span aria-hidden="true" class="wpforms-required-label">*</span></label>
                  <input type="email" id="contact-email" name="email" placeholder="you@example.com" required autocomplete="email" />
                </div>

                <div class="wpforms-field">
                  <label class="wpforms-field-label" for="contact-zip" style="color: white !important;">ZIP Code</label>
                  <input type="text" id="contact-zip" name="zip" pattern="[0-9]{5}" maxlength="5" inputmode="numeric" placeholder="12345">
                  <input type="hidden" id="contact-city" name="city" value="">
                  <input type="hidden" id="contact-state" name="state" value="">
                  <!-- Suggestions dropdown -->
                  <div id="zip-suggest" class="zip-suggest" role="listbox" aria-label="ZIP suggestions" style="display:none;"></div>
                </div>

                <div class="wpforms-field">
                  <label class="wpforms-field-label" for="contact-message" style="color: white !important;">How can we help?</label>
                  <textarea id="contact-message" name="message" rows="4" placeholder="Tell us about your pool and what you need..."></textarea>
                </div>
              </div>

              <input type="hidden" name="source" value="contact-top" />
              <div class="wpforms-submit-container">
                <button type="submit" class="wpforms-submit" style="background-color: var(--brand-yellow) !important; border-color: var(--brand-yellow) !important; color: var(--brand-blue) !important;">Get My Free Estimate</button>
                <div id="contactForm1Status" class="text-muted mt-2" style="color:#fff !important;"></div>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div> <!-- End Container -->
  </section>

  <!-- Reviews Block (editable) -->
  <section class="bg-garageup-primary bg-icon reviews-container">
    <div class="container">
      <h2 class="section-title text-center mb-5"><%= (contact && contact.reviewsTitle) || 'Discover our 5 Star Reputation' %></h2>
      <section class="resi-reviews">
        <div class="container">
          <div class="resi-reviews--inner">
            <div class="resi-review"><div class="resi-review--inner"><div class="resi-review--stars">★★★★★</div><div class="resi-review--content check-overflow"><div class="resi-review--content--inner"><p><%= (contact && contact.review1Text) || 'Great company!!! Very reliable. Skilled workmanship. Love our garage!!!' %></p></div></div><div class="resi-review--meta"><h5 class="resi-review--author"><%= (contact && contact.review1Author) || 'Barry Kramer' %></h5></div></div></div>
            <div class="resi-review"><div class="resi-review--inner"><div class="resi-review--stars">★★★★★</div><div class="resi-review--content check-overflow"><div class="resi-review--content--inner"><p><%= (contact && contact.review2Text) || 'The crew out of Lakeway did an amazing job. Very flexible with timing—overall very happy with the end result.' %></p></div></div><div class="resi-review--meta"><h5 class="resi-review--author"><%= (contact && contact.review2Author) || 'Paul Flavion' %></h5></div></div></div>
            <div class="resi-review"><div class="resi-review--inner"><div class="resi-review--stars">★★★★★</div><div class="resi-review--content check-overflow"><div class="resi-review--content--inner"><p><%= (contact && contact.review3Text) || 'Swim Studs gave our system a full tune-up—now it works like new again. Professional and thorough. Highly recommend.' %></p></div></div><div class="resi-review--meta"><h5 class="resi-review--author"><%= (contact && contact.review3Author) || 'Michelle Morrison' %></h5></div></div></div>
          </div>
        </div>
      </section>
    </div>
  </section>

  <script>
    (function(){
      try {
        var zipInput = document.getElementById('contact-zip');
        var cityInput = document.getElementById('contact-city');
        var stateInput = document.getElementById('contact-state');
        var suggest = document.getElementById('zip-suggest');
        if (!zipInput) return;

        function hideSuggest(){ if (suggest) { suggest.style.display = 'none'; suggest.innerHTML = ''; } }
        function showSuggest(items){
          if (!suggest) return;
          if (!items || !items.length) { hideSuggest(); return; }
          suggest.innerHTML = '';
          items.forEach(function(item, idx){
            var div = document.createElement('div');
            div.className = 'item';
            div.setAttribute('role','option');
            div.setAttribute('aria-selected', idx === 0 ? 'true' : 'false');
            div.innerHTML = '\n              <span class="icon" aria-hidden="true">\n                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n                  <path d="M12 2C8.14 2 5 5.14 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.86-3.14-7-7-7Zm0 9.5a2.5 2.5 0 1 1 0-5 2.5 2.5 0 0 1 0 5Z" fill="currentColor"/>\n                </svg>\n              </span>\n              <span class="primary">' + item.primary + '</span>' + (item.secondary ? ' <span class="secondary">' + item.secondary + '</span>' : '');
            div.addEventListener('click', function(){
              zipInput.value = item.zip;
              if (cityInput) cityInput.value = item.city || '';
              if (stateInput) stateInput.value = item.state || '';
              hideSuggest();
              zipInput.dispatchEvent(new Event('change'));
            });
            suggest.appendChild(div);
          });
          suggest.style.display = 'block';
        }

        function lookupZip(zip){
          var clean = String(zip || '').replace(/\D/g, '').slice(0,5);
          if (clean.length !== 5) { hideSuggest(); return; }
          fetch('https://api.zippopotam.us/us/' + clean)
            .then(function(r){ if (!r.ok) throw new Error('not found'); return r.json(); })
            .then(function(data){
              var place = (data.places && data.places[0]) || null;
              var city = place ? place['place name'] : '';
              var state = place ? place['state abbreviation'] : '';
              if (cityInput) cityInput.value = city || '';
              if (stateInput) stateInput.value = state || '';
              var label = (city && state) ? (city + ', ' + state + ' ' + clean + ', USA') : (clean + ', USA');
              showSuggest([{ primary: label, secondary: '', zip: clean, city: city, state: state }]);
            })
            .catch(function(){ hideSuggest(); });
        }

        // Debounced input handler
        var timer;
        zipInput.addEventListener('input', function(){
          var v = zipInput.value.replace(/\D/g,'').slice(0,5);
          zipInput.value = v;
          clearTimeout(timer);
          if (v.length < 5) { hideSuggest(); return; }
          timer = setTimeout(function(){ lookupZip(v); }, 200);
        });
        zipInput.addEventListener('blur', function(){ setTimeout(hideSuggest, 150); });

        // Initialize from query params if present
        try {
          var p = new URLSearchParams(window.location.search);
          var qzip = p.get('zip');
          var qcity = p.get('city');
          var qstate = p.get('state');
          if (qzip) { zipInput.value = String(qzip).replace(/\D/g,'').slice(0,5); }
          if (qcity && cityInput) cityInput.value = qcity;
          if (qstate && stateInput) stateInput.value = qstate;
          if (zipInput.value && (!qcity || !qstate)) { lookupZip(zipInput.value); }
          if (zipInput.value && qcity && qstate) {
            showSuggest([{ primary: qcity + ', ' + qstate + ' ' + zipInput.value + ', USA', secondary: '', zip: zipInput.value, city: qcity, state: qstate }]);
          }
        } catch(_){}
      } catch(e) { /* no-op */ }
    })();
  </script>

  <script>
    (function(){
      try {
        function wireValidation(formId){
          var form = document.getElementById(formId);
          if (!form) return;
          // Real-time aria-invalid for accessibility
          form.addEventListener('input', function(ev){
            var el = ev.target;
            if (!(el && el.checkValidity)) return;
            el.setAttribute('aria-invalid', el.checkValidity() ? 'false' : 'true');
          });
          form.addEventListener('submit', function(ev){
            if (!form.checkValidity()){
              ev.preventDefault();
              ev.stopPropagation();
              try { form.reportValidity(); } catch(_) {}
              var firstInvalid = form.querySelector(':invalid');
              if (firstInvalid && firstInvalid.focus) firstInvalid.focus();
              return false;
            }
          }, true);
        }
        wireValidation('contactForm1');
        wireValidation('contactForm2');
      } catch(_) {}
    })();
  </script>

  <div class="container">
    <div class="bottom-form-wrapper mt-5 col-sm-12">
      <div class="inner-wrapper">
        <div class="title-wrapper col-sm-12">
          <h2><%= (contact && contact.bottomTitle) || 'Get An Estimate' %></h2>
        </div>
        <div class="wpforms-container wpforms-container-full wpforms-render-modern">
          <form id="contactForm2" class="wpforms-validate wpforms-form" method="post" action="/api/leads">
            <div class="wpforms-field-container">
              <div class="wpforms-field wpforms-field-name">
                <fieldset>
                  <legend class="wpforms-field-label">Name <span class="wpforms-required-label" aria-hidden="true">*</span></legend>
                  <div class="wpforms-field-row wpforms-field-large">
                    <div class="wpforms-field-row-block wpforms-first wpforms-one-half">
                      <input type="text" class="wpforms-field-name-first wpforms-field-required" name="firstName" required />
                      <label class="after">First</label>
                    </div>
                    <div class="wpforms-field-row-block wpforms-one-half">
                      <input type="text" class="wpforms-field-name-last wpforms-field-required" name="lastName" required />
                      <label class="after">Last</label>
                    </div>
                  </div>
                </fieldset>
              </div>

              <div class="wpforms-field wpforms-field-phone">
                <label class="wpforms-field-label" for="estimate-phone">Phone <span class="wpforms-required-label" aria-hidden="true">*</span></label>
                <input id="estimate-phone" type="tel" name="phone" inputmode="tel" pattern="^\\+?[0-9\\s().-]{7,}$" required autocomplete="tel" />
              </div>

              <div class="wpforms-field wpforms-field-email">
                <label class="wpforms-field-label" for="estimate-email">Email <span class="wpforms-required-label" aria-hidden="true">*</span></label>
                <input id="estimate-email" type="email" name="email" required autocomplete="email" />
              </div>

              <div class="wpforms-field">
                <label class="wpforms-field-label" for="estimate-zip">ZIP Code</label>
                <input id="estimate-zip" type="text" name="zip" pattern="[0-9]{5}" maxlength="5" inputmode="numeric" />
                <input type="hidden" id="estimate-city" name="city" />
                <input type="hidden" id="estimate-state" name="state" />
              </div>

              <div class="wpforms-field">
                <label class="wpforms-field-label" for="estimate-message">How can we help?</label>
                <textarea id="estimate-message" name="message" rows="4"></textarea>
              </div>
            </div>

            <input type="hidden" name="source" value="contact-bottom" />
            <div class="wpforms-submit-container">
              <button type="submit" class="wpforms-submit">Get My Free Estimate</button>
              <div id="contactForm2Status" class="text-muted mt-2"></div>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- CTA -->
  <%- include('partials/get-started', {
    title: (contact && contact.ctaTitle) || 'Ready to get started?',
    body: (contact && contact.ctaBody) || 'Contact us for a free onsite estimate within 24 hours.',
    url: (contact && contact.ctaUrl) || '/contact-us',
    label: (contact && contact.ctaLabel) || 'Contact Us'
  }) %>
</div>

<!-- Removed broken WPForms CSS includes (404s); page uses scoped styles above -->

<script>
  (function(){
    try {
      var params = new URLSearchParams(window.location.search || '');
      var zip = (params.get('zip') || '').replace(/\D/g,'').substring(0,5);
      var city = params.get('city') || '';
      var state = params.get('state') || '';

      var contactZip = document.getElementById('contact-zip');
      var estimateZip = document.getElementById('estimate-zip');
      var contactCity = document.getElementById('contact-city');
      var contactState = document.getElementById('contact-state');
      var estimateCity = document.getElementById('estimate-city');
      var estimateState = document.getElementById('estimate-state');

      if (zip) {
        if (contactZip) contactZip.value = zip;
        if (estimateZip) estimateZip.value = zip;
      }
      if (contactCity) contactCity.value = city;
      if (contactState) contactState.value = state;
      if (estimateCity) estimateCity.value = city;
      if (estimateState) estimateState.value = state;
    } catch(e) { /* no-op */ }
  })();
</script>

<%- include('partials/footer') %>
