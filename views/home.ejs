<%- include('partials/header') %>

<section class="hero hero-wrapper overlay-jade hero-aesthetic" data-hero-bg="<%= (homepage && homepage.heroBg) || '/wp-content/uploads/2025/09/1756764490731-7BD25153-9885-43B2-A855-485788BC9DAE.png' %>" style="background-image: url(&quot;<%= (homepage && homepage.heroBg) || '/wp-content/uploads/2025/09/1756764490731-7BD25153-9885-43B2-A855-485788BC9DAE.png' %>&quot;); background-repeat: no-repeat; background-size: cover; background-position: center center;">
  <div class="hero-overlay" aria-hidden="true"></div>

  <div class="content-wrapper container position-relative">
    <div class="row align-items-center justify-content-center">
      <!-- Main content centered -->
      <div class="col-12 hero-main-content text-center">
        <h1 class="hero-main-title mb-3">Your Trusted Pool Care Experts</h1>
        <p class="hero-description mb-4">Pool Cleaning, Chemical Balancing, Equipment Service, and More</p>
        
        <div class="hero-buttons">
          <a class="btn btn-brand-primary me-3" href="/contact">Learn More</a>
          <button class="btn btn-outline-light">Browse services &gt;</button>
        </div>
      </div>
    </div>
    
    <!-- ZIP search bar positioned at bottom center -->
    <div class="zip-bottom-container">
      <div class="zip-code-search">
        <form role="search" aria-label="Find franchise by ZIP code" class="zip-card">
          <label for="zip-search-input" class="visually-hidden">ZIP Code</label>
          <div class="input-group input-group-lg">
            <span class="input-group-text bg-white border-0" aria-hidden="true">
              <svg width="22" height="22" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg" focusable="false" aria-hidden="true">
                <path d="M19.3115 21.1768L19.4883 21.3535L19.665 21.1768L21.1768 19.6651L21.3536 19.4883L21.1768 19.3116L16.6315 14.7665C17.7498 13.2602 18.3556 11.4325 18.3559 9.55253V9.55249C18.3559 4.69878 14.4069 0.75 9.55295 0.75C4.69901 0.75 0.75 4.69878 0.75 9.55249C0.75 14.4062 4.69901 18.355 9.55295 18.355C11.4325 18.3548 13.26 17.7494 14.7661 16.6317L19.3115 21.1768ZM9.55295 3.38812C12.9526 3.38812 15.7177 6.15305 15.7177 9.55249C15.7177 12.9519 12.9526 15.7169 9.55295 15.7169C6.15329 15.7169 3.38824 12.9519 3.38824 9.55249C3.38824 6.15305 6.15329 3.38812 9.55295 3.38812Z" fill="#05132D" stroke="#05132D" stroke-width="0.5"></path>
              </svg>
            </span>
            <input
              type="text"
              id="zip-search-input"
              class="form-control border-0"
              placeholder="Enter ZIP code"
              inputmode="numeric"
              autocomplete="postal-code"
              pattern="[0-9]{5}"
              maxlength="5"
              aria-describedby="zip-search-help"
            />
            <button type="button" class="btn btn-light border-0 clear-zip-btn d-none" aria-label="Clear ZIP" title="Clear">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                <circle cx="12" cy="12" r="10" stroke="#6c757d" stroke-width="2"/>
                <line x1="15" y1="9" x2="9" y2="15" stroke="#6c757d" stroke-width="2"/>
                <line x1="9" y1="9" x2="15" y2="15" stroke="#6c757d" stroke-width="2"/>
              </svg>
            </button>
            <button type="submit" class="btn btn-brand-primary px-4">Search</button>
          </div>
          <div id="zip-search-help" class="visually-hidden">Enter a 5-digit ZIP code to find your local franchise</div>
        </form>
      </div>
    </div>
    <!-- Map container anchored to bottom of hero -->
    <div class="zip-map-container" style="display: none;">
      <div id="zip-map" style="height: 100%; border-radius: 12px; overflow: hidden;"></div>
    </div>
  </div>
</section>

<!-- (removed duplicate early ZIP modal block) -->

<!-- Page-scoped styles: Hero aesthetic -->
<style>
  /* ZIP capture modal styles */
  .zip-modal-backdrop { position: fixed; inset: 0; background: rgba(0,0,0,.55); display: none; align-items: center; justify-content: center; z-index: 1050; }
  .zip-modal { background: #fff; color: #05132D; width: min(520px, 92vw); border-radius: 16px; box-shadow: 0 24px 64px rgba(0,0,0,.35); overflow: hidden; }
  .zip-modal header { padding: 1rem 1.25rem; font-weight: 800; font-size: 1.25rem; border-bottom: 1px solid #eee; }
  .zip-modal .body { padding: 1rem 1.25rem; }
  .zip-modal .actions { display: flex; gap: .75rem; justify-content: flex-end; padding: 1rem 1.25rem; border-top: 1px solid #eee; }
  .zip-input-group { display: flex; align-items: center; gap: .5rem; border: 1px solid #ddd; padding: .5rem .75rem; border-radius: 10px; }
  .zip-input-group input { border: none; outline: none; flex: 1; font-size: 1rem; }
  .zip-suggest-modal { margin-top: .5rem; border-radius: 10px; overflow: hidden; border: 1px solid #eee; display: none; }
  .zip-suggest-modal .item { display: flex; align-items: center; gap: .5rem; padding: .6rem .75rem; background: #fff; cursor: pointer; }
  .zip-suggest-modal .item:hover { background: #f5f5f5; }
  .btn-cancel { background: transparent; border: 1px solid #ddd; border-radius: 8px; padding: .6rem 1rem; }
  .btn-continue { background: var(--brand-red); color: #fff; border: 0; border-radius: 8px; padding: .6rem 1rem; }
  .hero-aesthetic {
    position: relative;
    /* extra bottom padding so bottom-anchored ZIP has room */
    padding: clamp(6rem, 10vw, 12rem) 0 clamp(8rem, 10vw, 10rem) 0;
    color: #fff;
    min-height: 100vh;
    display: flex;
    align-items: center;
    overflow: visible; /* allow anchored ZIP to be visible */
  }
  /* When map is open, reserve extra bottom space equal to map height */
  .hero-aesthetic.map-open {
    padding-bottom: calc(clamp(8rem, 10vw, 10rem) + 45vh + 1.5rem);
  }
  /* Ensure the absolute ZIP card anchors to the full hero, not the inner container */
  .hero-aesthetic .content-wrapper { position: static !important; }
  /* Center the row's content in the hero (desktop) */
  .hero-aesthetic .content-wrapper .row.align-items-center { justify-content: center !important; }
  /* Explicitly override Bootstrap's justify-content-between on the hero row */
  .hero-aesthetic .content-wrapper .row.align-items-center.justify-content-between { justify-content: center !important; }
  
  /* Position ZIP search at bottom center */
  .zip-bottom-container {
    position: absolute;
    bottom: 2rem;
    left: 50%;
    transform: translateX(-50%);
    width: 100%;
    max-width: 600px;
    z-index: 10;
  }

  /* Disable ZIP feature globally */
  .zip-bottom-container,
  .zip-map-container { display: none !important; }
  
  @media (max-width: 768px) {
    .zip-bottom-container {
      bottom: 1rem;
      max-width: 90%;
    }
  }
  .hero-aesthetic .hero-overlay {
    position: absolute;
    inset: 0;
    background: linear-gradient(180deg, rgba(0, 0, 0, 0.4) 0%, rgba(0, 0, 0, 0.2) 40%, rgba(0, 0, 0, 0.4) 100%);
    pointer-events: none;
  }
  
  /* Left side main content */
  .hero-aesthetic .hero-main-content {
    z-index: 2;
    position: relative;
    text-align: center; /* center heading, copy, and buttons */
    margin-left: auto;
    margin-right: auto;
    max-width: 900px;
  }
  /* Override Bootstrap's text-left utility if present */
  .hero-aesthetic .hero-main-content.text-left { text-align: center !important; }
  .hero-aesthetic .hero-main-title {
    font-size: clamp(2.5rem, 5vw, 4rem);
    font-weight: 800;
    line-height: 1.1;
    color: #fff;
    text-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    margin-bottom: 1.5rem;
  }
  .hero-aesthetic .hero-description {
    font-size: 1.1rem;
    line-height: 1.6;
    color: rgba(255, 255, 255, 0.9);
    max-width: 500px;
    margin-bottom: 2rem;
    margin-left: auto;
    margin-right: auto;
    text-align: center;
  }
  .hero-aesthetic .hero-buttons {
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
    justify-content: center; /* center buttons under headline */
  }
  .hero-aesthetic .btn-brand-primary {
    background-color: var(--brand-red) !important;
    border-color: var(--brand-red) !important;
    padding: 0.75rem 1.5rem;
    font-weight: 600;
    border-radius: 8px;
    transition: all 0.3s ease;
    color: #fff;
  }
  .hero-aesthetic .btn-brand-primary:hover {
    filter: brightness(1.05);
    transform: translateY(-2px);
    color: #fff;
  }
  .hero-aesthetic .btn-outline-light {
    padding: 0.75rem 1.5rem;
    font-weight: 600;
    border-radius: 8px;
    border: 2px solid rgba(255, 255, 255, 0.8);
    color: #fff;
    background: transparent;
    transition: all 0.3s ease;
  }
  .hero-aesthetic .btn-outline-light:hover {
    background-color: rgba(255, 255, 255, 0.1);
    border-color: #fff;
    color: #fff;
    transform: translateY(-2px);
  }
  
  /* Right side contact card */
  .hero-aesthetic .hero-contact-card {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    border-radius: 20px;
    padding: 2rem;
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
    border: 1px solid rgba(255, 255, 255, 0.2);
    position: relative;
    z-index: 2;
  }
  .hero-aesthetic .contact-card-title {
    color: #333;
    font-size: 1.5rem;
    font-weight: 700;
    margin-bottom: 1rem;
  }
  .hero-aesthetic .contact-card-subtitle {
    color: #666;
    font-size: 0.95rem;
    line-height: 1.5;
    margin-bottom: 1.5rem;
  }
  .hero-aesthetic .hero-contact-form .input-group {
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  }
  .hero-aesthetic .hero-contact-form .form-control {
    border: none;
    padding: 1rem 1.25rem;
    font-size: 1rem;
    background: #fff;
    color: #333;
  }
  .hero-aesthetic .hero-contact-form .form-control:focus {
    box-shadow: none;
    border-color: transparent;
  }
  .hero-aesthetic .hero-contact-form .form-control::placeholder {
    color: #999;
  }
  .hero-aesthetic .contact-submit-btn {
    background-color: var(--brand-red) !important;
    border-color: var(--brand-red) !important;
    padding: 1rem 1.25rem;
    border: none;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
    color: #fff;
  }
  .hero-aesthetic .contact-submit-btn:hover {
    filter: brightness(1.05);
    transform: translateX(2px);
    color: #fff;
  }
  /* ZIP card styles (restored) */
  .hero-aesthetic .zip-card {
    margin-top: 0.25rem;
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: saturate(140%) blur(8px);
    -webkit-backdrop-filter: saturate(140%) blur(8px);
    border-radius: 20px;
    padding: 0.75rem;
    box-shadow: 0 10px 26px rgba(0, 0, 0, 0.20), 0 2px 8px rgba(0, 0, 0, 0.10);
    border: 1px solid rgba(0, 0, 0, 0.06);
    width: 100%;
    position: relative;
    z-index: 1;
    transition: box-shadow .2s ease, border-color .2s ease;
  }
  /* Place the ZIP search at bottom-right of hero on desktop (strong override) */
  .hero.hero-aesthetic .zip-code-search {
    position: absolute !important;
    right: 2rem !important;
    bottom: 2rem !important;
    left: auto !important;
    top: auto !important;
    z-index: 3 !important;
    width: min(520px, 92vw) !important;
    margin: 0 !important;
    pointer-events: auto;
  }
  /* Remove layout footprint of the right column that only holds the ZIP card on desktop */
  @media (min-width: 992px) {
    .hero-aesthetic .zip-col { display: contents; }
  }
  .hero-aesthetic .zip-card:focus-within {
    box-shadow: 0 0 0 3px var(--brand-red), 0 12px 30px rgba(0,0,0,.25);
    border-color: var(--brand-red);
  }
  .hero-aesthetic .zip-card .input-group-text {
    background: transparent !important;
    border: none !important;
    padding-left: .75rem;
    padding-right: .5rem;
  }
  .hero-aesthetic .zip-card .form-control {
    border: none !important;
    background: transparent !important;
    box-shadow: none !important;
    border-radius: 18px 0 0 18px;
    padding: .75rem .25rem;
    font-size: 1.05rem;
    color: #05132D;
  }
  .hero-aesthetic .zip-card .form-control::placeholder { color: rgba(5, 19, 45, 0.55); }
  .hero-aesthetic .zip-card .btn {
    border-radius: 18px;
    font-weight: 700;
    letter-spacing: 0.02em;
    box-shadow: 0 8px 18px rgba(0,0,0,.18);
    transition: transform .15s ease, box-shadow .15s ease;
  }
  .hero-aesthetic .zip-card .btn:hover { transform: translateY(-1px); box-shadow: 0 10px 22px rgba(0,0,0,.22); }
  /* ZIP results card */
  .hero-aesthetic .zip-code-results {
    display: none;
    margin-top: 0.75rem;
    background: rgba(255,255,255,0.98);
    border: 1px solid rgba(0,0,0,0.06);
    border-radius: 18px;
    padding: 0.75rem 1rem;
    box-shadow: 0 10px 24px rgba(0,0,0,0.12);
    color: #05132D;
  }
  .hero-aesthetic .zip-code-results.is-visible { display: block; }
  
  /* ZIP result states styling */
  .zip-success, .zip-unavailable, .zip-error, .zip-loading {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.5rem 0;
  }
  
  .zip-success {
    flex-direction: column;
    align-items: stretch;
    gap: 1rem;
  }
  
  .zip-location {
    display: flex;
    align-items: center;
    gap: 0.75rem;
  }
  
  .zip-location svg {
    color: var(--brand-red);
    flex-shrink: 0;
  }
  
  .franchise-info, .service-status {
    font-size: 0.9rem;
    color: #666;
    margin-top: 0.25rem;
  }
  
  .zip-actions {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
  }
  
  .zip-actions .btn-sm {
    padding: 0.5rem 1rem;
    font-size: 0.875rem;
    border-radius: 6px;
  }
  
  .zip-error {
    color: #dc3545;
  }
  
  .zip-error svg {
    color: #dc3545;
    flex-shrink: 0;
  }
  
  .zip-loading {
    color: #666;
  }
  
  .zip-loading svg {
    color: var(--brand-red);
    flex-shrink: 0;
    animation: spin 1s linear infinite;
  }
  
  @keyframes spin {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
  }
  
  /* ZIP Map Container: expand to bottom area of hero */
  .zip-map-container {
    position: absolute;
    left: 50%;
    transform: translateX(-50%);
    bottom: 0; /* anchor to bottom of hero */
    width: min(900px, 95vw);
    height: 45vh; /* occupies bottom portion of hero */
    display: none;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 8px 20px rgba(0,0,0,0.15);
    background: #fff; /* fallback bg while iframe loads */
    z-index: 2;
  }

  .zip-map-container.is-visible { display: block !important; }

  @media (max-width: 768px) {
    .zip-map-container {
      width: 94vw;
      height: 40vh;
    }
  }
  
  /* Responsive adjustments */
  @media (max-width: 991.98px) {
    .hero-aesthetic .hero-main-content {
      text-align: center;
      margin-bottom: 3rem;
    }
    /* On mobile: anchor ZIP card to bottom-center */
    .hero.hero-aesthetic .zip-code-search {
      position: absolute !important;
      left: 50% !important;
      transform: translateX(-50%);
      right: auto !important;
      top: auto !important;
      bottom: 1rem !important;
      width: min(92vw, 560px) !important;
      margin: 0 !important;
    }
    /* On mobile, column flows normally (no display: contents) */
    .hero-aesthetic .zip-col { display: block; }
  }
  @media (max-width: 576px) {
    .hero-aesthetic {
      padding: 4rem 0 3rem 0;
    }
    .hero-aesthetic .hero-main-title {
      font-size: 2.5rem;
    }
    .hero-aesthetic .hero-buttons {
      justify-content: center;
    }
    .hero-aesthetic .hero-contact-card {
      padding: 1.5rem;
    }
  }
</style>

<script>
  (function(){
    try {
      var scroller = document.querySelector('.scroller');
      if (!scroller) return;
      var inner = scroller.querySelector('.scroller__inner');
      if (!inner) return;
      if (inner.dataset.duplicated === 'true') return;
      // Duplicate children to enable seamless infinite scroll
      inner.innerHTML = inner.innerHTML + inner.innerHTML;
      inner.dataset.duplicated = 'true';
    } catch (e) { /* no-op */ }
  })();
</script>

<!-- Page-scoped styles: Blog, Warranty, Reviews, CTA modern refresh -->
<style>
  /* Blog Featured */
  .blogFeat { padding: 3rem 0 2rem; }
  .blogFeat .content-wrapper > h4 {
    letter-spacing: .12em; font-weight: 800; color: var(--brand-red); opacity: .9; margin-bottom: .25rem;
  }
  .blogFeat .content-wrapper > .section-title { margin-bottom: 1.5rem; }
  /* Blog slider */
  .blog-slider { position: relative; display: grid; grid-template-columns: auto 1fr auto; align-items: center; gap: .5rem; }
  .blog-slider .blog-nav { background: var(--brand-red); color: #fff; border: none; width: 42px; height: 42px; border-radius: 50%; font-size: 1.5rem; line-height: 1; display: inline-flex; align-items: center; justify-content: center; box-shadow: 0 8px 18px rgba(0,0,0,.18); }
  .blog-slider .blog-nav:hover { filter: brightness(1.05); }
  .blog-slider .blog-nav:disabled { opacity: .45; cursor: default; }
  .featured-posts-wrapper { display: flex; flex-wrap: nowrap; gap: 1rem; overflow: hidden; scroll-behavior: smooth; scroll-snap-type: x mandatory; }
  .featured-posts-wrapper > a.feat-post { flex: 0 0 auto; width: clamp(260px, 28vw, 320px); border-radius: 16px; overflow: hidden; box-shadow: 0 12px 28px rgba(0,0,0,.12); background: #fff; scroll-snap-align: start; }
  .featured-posts-wrapper > a.feat-post:hover { transform: translateY(-4px); box-shadow: 0 18px 36px rgba(0,0,0,.22); }
  .featured-posts-wrapper .post { height: 100%; display: grid; grid-template-rows: auto 1fr; }
  .featured-posts-wrapper .post-thumbnail { position: relative; aspect-ratio: 4/3; overflow: hidden; }
  .featured-posts-wrapper .post-thumbnail img { width: 100%; height: 100%; object-fit: cover; display: block; transform: scale(1.02); transition: transform .4s ease; }
  .featured-posts-wrapper a.feat-post:hover .post-thumbnail img { transform: scale(1.06); }
  .featured-post-detail .detail-actions .btn { border-radius: 999px; }
  /* Slider track should span available width */
  .featured-posts-wrapper { width: 100%; }
  /* Active card outline */
  .featured-posts-wrapper a.feat-post.is-active { outline: 3px solid var(--brand-red); outline-offset: 2px; }
  @media (max-width: 991.98px) { .featured-posts-wrapper > a.feat-post { width: clamp(240px, 60vw, 300px); } }
  @media (max-width: 768px) {
    .blog-split { grid-template-columns: 1fr; }
    .featured-post-detail { order: -1; }
    .featured-post-detail .detail-card { position: static; }
  }
  @media (max-width: 576px) { .featured-posts-wrapper { gap: .75rem; } .featured-posts-wrapper > a.feat-post { border-radius: 12px; width: 82%; } }
  .warranty p { color: #fff; max-width: 900px; margin-left: auto; margin-right: auto; opacity: .95; }
  .warranty .section-title + p { margin-top: .5rem; }

  /* Reviews as scroll-snap cards */
  .resi-reviews--inner { display: flex; gap: 1rem; overflow-x: auto; scroll-snap-type: x mandatory; padding: .25rem 0 .5rem; }
  .resi-reviews--inner::-webkit-scrollbar { height: 8px; }
  .resi-reviews--inner::-webkit-scrollbar-thumb { background: rgba(0,0,0,.2); border-radius: 999px; }
  .resi-review { flex: 0 0 auto; min-width: 320px; max-width: 420px; scroll-snap-align: start; }
  .resi-review--inner { background: #ffffff; border-radius: 14px; box-shadow: 0 10px 22px rgba(0,0,0,.12); padding: 1rem; height: 100%; display: grid; grid-template-rows: auto 1fr auto; border: 1px solid rgba(0,0,0,.06); }
  .resi-review--stars { color: var(--brand-red); font-size: 1.05rem; letter-spacing: .06em; }
  .resi-review--content { color: #05132D; }
  .resi-review--author { font-weight: 800; margin: .5rem 0 0; color: #05132D; }
  @media (max-width: 576px) { .resi-review { min-width: 85%; } }

  /* Get Started CTA */
  .get-started { position: relative; border-radius: 20px; padding: 2rem 1.25rem; overflow: hidden; box-shadow: 0 18px 36px rgba(0,0,0,.14); }
  .get-started::before { content: ""; position: absolute; inset: 0; background: linear-gradient(135deg, rgba(255,255,255,.08), rgba(255,255,255,0)); pointer-events: none; }
  .get-started .estimate-prompt { text-align: center; }
  .get-started .section-title { color: #fff; font-weight: 900; }
  .get-started p { color: #fff; opacity: .95; }
  .get-started .btn-wrapper .btn { border-radius: 999px; padding: .75rem 1.25rem; font-weight: 800; }

  /* Clamp long text and add Read more button (on-brand) */
  .clamp-3 { display: -webkit-box; -webkit-line-clamp: 3; line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden; }
  .clamp-4 { display: -webkit-box; -webkit-line-clamp: 4; line-clamp: 4; -webkit-box-orient: vertical; overflow: hidden; }
  .fade-after { position: relative; }
  .fade-after::after {
    content: ""; position: absolute; left: 0; right: 0; bottom: 0; height: 2.2em;
    background: linear-gradient(to bottom, rgba(255,255,255,0), rgba(255,255,255,1));
    pointer-events: none;
  }
  /* Adjust fade to yellow cards inside blog */
  .featured-posts-wrapper a.feat-post .entry-summary.fade-after::after { background: linear-gradient(to bottom, rgba(255,255,255,0), var(--brand-yellow)); }
  .read-more-btn { background: none; border: none; color: var(--brand-red); font-weight: 800; padding: .25rem 0; cursor: pointer; }
  .read-more-btn:focus { outline: 3px solid var(--brand-red); outline-offset: 2px; }
</style>

<script>
  // ZIP code lookup functionality
  (function(){
    try {
      // Feature toggle: fully disable ZIP search and remove its DOM
      var zipFeatureDisabled = true;
      if (zipFeatureDisabled) {
        try {
          var zb = document.querySelector('.zip-bottom-container');
          if (zb) zb.remove();
          var zm = document.querySelector('.zip-map-container');
          if (zm) zm.remove();
        } catch(_) {}
        return;
      }
      var form = document.querySelector('.zip-card');
      var input = document.querySelector('#zip-search-input');
      var results = document.querySelector('.zip-code-results');
      var mapContainer = document.querySelector('.zip-map-container');
      var heroSection = document.querySelector('section.hero.hero-wrapper');
      var clearBtn = document.querySelector('.clear-zip-btn');
      var lastZipResult = null; // store last successful lookup for redirect
      if (!form || !input) return;
      function setError(msg){
        input.setCustomValidity(msg || '');
        if (msg) { try { input.reportValidity(); } catch(_){} }
      }

      // Sample service areas data (replace with your actual data or API)
      var serviceAreas = {
        '78701': { city: 'Austin', state: 'TX', available: true, franchise: 'Austin Central' },
        '78702': { city: 'Austin', state: 'TX', available: true, franchise: 'Austin East' },
        '78703': { city: 'Austin', state: 'TX', available: true, franchise: 'Austin West' },
        '78704': { city: 'Austin', state: 'TX', available: true, franchise: 'Austin South' },
        '78705': { city: 'Austin', state: 'TX', available: true, franchise: 'Austin Central' },
        '78731': { city: 'Austin', state: 'TX', available: true, franchise: 'Austin West' },
        '78732': { city: 'Austin', state: 'TX', available: true, franchise: 'Austin West' },
        '78733': { city: 'Austin', state: 'TX', available: true, franchise: 'Austin West' },
        '78734': { city: 'Austin', state: 'TX', available: true, franchise: 'Austin West' },
        '78735': { city: 'Austin', state: 'TX', available: true, franchise: 'Austin Southwest' },
        '78736': { city: 'Austin', state: 'TX', available: true, franchise: 'Austin Southwest' },
        '78737': { city: 'Austin', state: 'TX', available: true, franchise: 'Austin Southwest' },
        '78738': { city: 'Austin', state: 'TX', available: true, franchise: 'Austin West' },
        '78739': { city: 'Austin', state: 'TX', available: true, franchise: 'Austin Southwest' },
        '78741': { city: 'Austin', state: 'TX', available: true, franchise: 'Austin East' },
        '78742': { city: 'Austin', state: 'TX', available: true, franchise: 'Austin Southeast' },
        '78744': { city: 'Austin', state: 'TX', available: true, franchise: 'Austin South' },
        '78745': { city: 'Austin', state: 'TX', available: true, franchise: 'Austin South' },
        '78746': { city: 'Austin', state: 'TX', available: true, franchise: 'Austin West' },
        '78747': { city: 'Austin', state: 'TX', available: true, franchise: 'Austin Southwest' },
        '78748': { city: 'Austin', state: 'TX', available: true, franchise: 'Austin South' },
        '78749': { city: 'Austin', state: 'TX', available: true, franchise: 'Austin Southwest' },
        '78750': { city: 'Austin', state: 'TX', available: true, franchise: 'Austin Northwest' },
        '78751': { city: 'Austin', state: 'TX', available: true, franchise: 'Austin Central' },
        '78752': { city: 'Austin', state: 'TX', available: true, franchise: 'Austin Northeast' },
        '78753': { city: 'Austin', state: 'TX', available: true, franchise: 'Austin Northeast' },
        '78754': { city: 'Austin', state: 'TX', available: true, franchise: 'Austin Northeast' },
        '78756': { city: 'Austin', state: 'TX', available: true, franchise: 'Austin Central' },
        '78757': { city: 'Austin', state: 'TX', available: true, franchise: 'Austin Northwest' },
        '78758': { city: 'Austin', state: 'TX', available: true, franchise: 'Austin North' },
        '78759': { city: 'Austin', state: 'TX', available: true, franchise: 'Austin Northwest' },
        '75001': { city: 'Addison', state: 'TX', available: true, franchise: 'Dallas North' },
        '75002': { city: 'Allen', state: 'TX', available: true, franchise: 'Dallas North' },
        '75201': { city: 'Dallas', state: 'TX', available: true, franchise: 'Dallas Downtown' },
        '75202': { city: 'Dallas', state: 'TX', available: true, franchise: 'Dallas Downtown' },
        '75203': { city: 'Dallas', state: 'TX', available: true, franchise: 'Dallas East' },
        '75204': { city: 'Dallas', state: 'TX', available: true, franchise: 'Dallas Central' },
        '75205': { city: 'Dallas', state: 'TX', available: true, franchise: 'Dallas Central' },
        '75206': { city: 'Dallas', state: 'TX', available: true, franchise: 'Dallas East' },
        '75207': { city: 'Dallas', state: 'TX', available: true, franchise: 'Dallas West' },
        '75208': { city: 'Dallas', state: 'TX', available: true, franchise: 'Dallas Southwest' },
        '75209': { city: 'Dallas', state: 'TX', available: true, franchise: 'Dallas Central' },
        '75210': { city: 'Dallas', state: 'TX', available: true, franchise: 'Dallas East' },
        '75211': { city: 'Dallas', state: 'TX', available: true, franchise: 'Dallas West' },
        '75212': { city: 'Dallas', state: 'TX', available: true, franchise: 'Dallas Northwest' },
        '75214': { city: 'Dallas', state: 'TX', available: true, franchise: 'Dallas East' },
        '75215': { city: 'Dallas', state: 'TX', available: true, franchise: 'Dallas Southeast' },
        '75216': { city: 'Dallas', state: 'TX', available: true, franchise: 'Dallas South' },
        '75217': { city: 'Dallas', state: 'TX', available: true, franchise: 'Dallas Southeast' },
        '75218': { city: 'Dallas', state: 'TX', available: true, franchise: 'Dallas Northeast' },
        '75219': { city: 'Dallas', state: 'TX', available: true, franchise: 'Dallas Central' },
        '75220': { city: 'Dallas', state: 'TX', available: true, franchise: 'Dallas Northwest' },
        '75221': { city: 'Dallas', state: 'TX', available: true, franchise: 'Dallas East' },
        '75222': { city: 'Dallas', state: 'TX', available: true, franchise: 'Dallas East' },
        '75223': { city: 'Dallas', state: 'TX', available: true, franchise: 'Dallas East' },
        '75224': { city: 'Dallas', state: 'TX', available: true, franchise: 'Dallas Southwest' },
        '75225': { city: 'Dallas', state: 'TX', available: true, franchise: 'Dallas Central' },
        '75226': { city: 'Dallas', state: 'TX', available: true, franchise: 'Dallas East' },
        '75227': { city: 'Dallas', state: 'TX', available: true, franchise: 'Dallas Southeast' },
        '75228': { city: 'Dallas', state: 'TX', available: true, franchise: 'Dallas Northeast' },
        '75229': { city: 'Dallas', state: 'TX', available: true, franchise: 'Dallas Northwest' },
        '75230': { city: 'Dallas', state: 'TX', available: true, franchise: 'Dallas North' },
        '75231': { city: 'Dallas', state: 'TX', available: true, franchise: 'Dallas Northeast' },
        '75232': { city: 'Dallas', state: 'TX', available: true, franchise: 'Dallas South' },
        '75233': { city: 'Dallas', state: 'TX', available: true, franchise: 'Dallas South' },
        '75234': { city: 'Dallas', state: 'TX', available: true, franchise: 'Dallas North' },
        '75235': { city: 'Dallas', state: 'TX', available: true, franchise: 'Dallas West' },
        '75236': { city: 'Dallas', state: 'TX', available: true, franchise: 'Dallas Southeast' },
        '75237': { city: 'Dallas', state: 'TX', available: true, franchise: 'Dallas South' },
        '75238': { city: 'Dallas', state: 'TX', available: true, franchise: 'Dallas Northeast' },
        '75240': { city: 'Dallas', state: 'TX', available: true, franchise: 'Dallas North' },
        '75241': { city: 'Dallas', state: 'TX', available: true, franchise: 'Dallas Southeast' },
        '75243': { city: 'Dallas', state: 'TX', available: true, franchise: 'Dallas Northeast' },
        '75244': { city: 'Dallas', state: 'TX', available: true, franchise: 'Dallas North' },
        '75246': { city: 'Dallas', state: 'TX', available: true, franchise: 'Dallas East' },
        '75247': { city: 'Dallas', state: 'TX', available: true, franchise: 'Dallas West' },
        '75248': { city: 'Dallas', state: 'TX', available: true, franchise: 'Dallas North' },
        '77001': { city: 'Houston', state: 'TX', available: true, franchise: 'Houston Downtown' },
        '77002': { city: 'Houston', state: 'TX', available: true, franchise: 'Houston Downtown' },
        '77003': { city: 'Houston', state: 'TX', available: true, franchise: 'Houston East' },
        '77004': { city: 'Houston', state: 'TX', available: true, franchise: 'Houston Central' },
        '77005': { city: 'Houston', state: 'TX', available: true, franchise: 'Houston Southwest' },
        '77006': { city: 'Houston', state: 'TX', available: true, franchise: 'Houston Central' },
        '77007': { city: 'Houston', state: 'TX', available: true, franchise: 'Houston Northwest' },
        '77008': { city: 'Houston', state: 'TX', available: true, franchise: 'Houston Northwest' },
        '77009': { city: 'Houston', state: 'TX', available: true, franchise: 'Houston North' },
        '77010': { city: 'Houston', state: 'TX', available: true, franchise: 'Houston Central' },
        '77011': { city: 'Houston', state: 'TX', available: true, franchise: 'Houston East' },
        '77012': { city: 'Houston', state: 'TX', available: true, franchise: 'Houston Southeast' },
        '77013': { city: 'Houston', state: 'TX', available: true, franchise: 'Houston East' },
        '77014': { city: 'Houston', state: 'TX', available: true, franchise: 'Houston North' },
        '77015': { city: 'Houston', state: 'TX', available: true, franchise: 'Houston East' },
        '77016': { city: 'Houston', state: 'TX', available: true, franchise: 'Houston Northwest' },
        '77017': { city: 'Houston', state: 'TX', available: true, franchise: 'Houston South' },
        '77018': { city: 'Houston', state: 'TX', available: true, franchise: 'Houston Northwest' },
        '77019': { city: 'Houston', state: 'TX', available: true, franchise: 'Houston Central' },
        '77020': { city: 'Houston', state: 'TX', available: true, franchise: 'Houston East' },
        '77021': { city: 'Houston', state: 'TX', available: true, franchise: 'Houston South' },
        '77022': { city: 'Houston', state: 'TX', available: true, franchise: 'Houston North' },
        '77023': { city: 'Houston', state: 'TX', available: true, franchise: 'Houston East' },
        '77024': { city: 'Houston', state: 'TX', available: true, franchise: 'Houston West' },
        '77025': { city: 'Houston', state: 'TX', available: true, franchise: 'Houston Southwest' },
        '77026': { city: 'Houston', state: 'TX', available: true, franchise: 'Houston Central' },
        '77027': { city: 'Houston', state: 'TX', available: true, franchise: 'Houston Central' },
        '77028': { city: 'Houston', state: 'TX', available: true, franchise: 'Houston Northeast' },
        '77029': { city: 'Houston', state: 'TX', available: true, franchise: 'Houston East' },
        '77030': { city: 'Houston', state: 'TX', available: true, franchise: 'Houston Central' },
        '77031': { city: 'Houston', state: 'TX', available: true, franchise: 'Houston Southwest' },
        '77032': { city: 'Houston', state: 'TX', available: true, franchise: 'Houston North' },
        '77033': { city: 'Houston', state: 'TX', available: true, franchise: 'Houston South' },
        '77034': { city: 'Houston', state: 'TX', available: true, franchise: 'Houston South' },
        '77035': { city: 'Houston', state: 'TX', available: true, franchise: 'Houston Southwest' },
        '77036': { city: 'Houston', state: 'TX', available: true, franchise: 'Houston Southwest' },
        '77037': { city: 'Houston', state: 'TX', available: true, franchise: 'Houston North' },
        '77038': { city: 'Houston', state: 'TX', available: true, franchise: 'Houston Northwest' },
        '77039': { city: 'Houston', state: 'TX', available: true, franchise: 'Houston Northeast' },
        '77040': { city: 'Houston', state: 'TX', available: true, franchise: 'Houston Northwest' },
        '77041': { city: 'Houston', state: 'TX', available: true, franchise: 'Houston West' },
        '77042': { city: 'Houston', state: 'TX', available: true, franchise: 'Houston West' },
        '77043': { city: 'Houston', state: 'TX', available: true, franchise: 'Houston West' },
        '77044': { city: 'Houston', state: 'TX', available: true, franchise: 'Houston Northeast' },
        '77045': { city: 'Houston', state: 'TX', available: true, franchise: 'Houston South' },
        '77046': { city: 'Houston', state: 'TX', available: true, franchise: 'Houston Central' },
        '77047': { city: 'Houston', state: 'TX', available: true, franchise: 'Houston Southeast' },
        '77048': { city: 'Houston', state: 'TX', available: true, franchise: 'Houston Southwest' },
        '77049': { city: 'Houston', state: 'TX', available: true, franchise: 'Houston Northeast' },
        '77050': { city: 'Houston', state: 'TX', available: true, franchise: 'Houston Southeast' },
        '77051': { city: 'Houston', state: 'TX', available: true, franchise: 'Houston South' },
        '77052': { city: 'Houston', state: 'TX', available: true, franchise: 'Houston Southwest' },
        '77053': { city: 'Houston', state: 'TX', available: true, franchise: 'Houston Southwest' },
        '77054': { city: 'Houston', state: 'TX', available: true, franchise: 'Houston South' },
        '77055': { city: 'Houston', state: 'TX', available: true, franchise: 'Houston Northwest' },
        '77056': { city: 'Houston', state: 'TX', available: true, franchise: 'Houston Central' },
        '77057': { city: 'Houston', state: 'TX', available: true, franchise: 'Houston West' },
        '77058': { city: 'Houston', state: 'TX', available: true, franchise: 'Houston Southeast' },
        '77059': { city: 'Houston', state: 'TX', available: true, franchise: 'Houston Southeast' },
        '77060': { city: 'Houston', state: 'TX', available: true, franchise: 'Houston North' },
        '77061': { city: 'Houston', state: 'TX', available: true, franchise: 'Houston Southwest' },
        '77062': { city: 'Houston', state: 'TX', available: true, franchise: 'Houston Southeast' },
        '77063': { city: 'Houston', state: 'TX', available: true, franchise: 'Houston West' },
        '77064': { city: 'Houston', state: 'TX', available: true, franchise: 'Houston Northwest' },
        '77065': { city: 'Houston', state: 'TX', available: true, franchise: 'Houston Northwest' },
        '77066': { city: 'Houston', state: 'TX', available: true, franchise: 'Houston North' },
        '77067': { city: 'Houston', state: 'TX', available: true, franchise: 'Houston Northwest' },
        '77068': { city: 'Houston', state: 'TX', available: true, franchise: 'Houston North' },
        '77069': { city: 'Houston', state: 'TX', available: true, franchise: 'Houston Northwest' },
        '77070': { city: 'Houston', state: 'TX', available: true, franchise: 'Houston Northwest' },
        '77071': { city: 'Houston', state: 'TX', available: true, franchise: 'Houston Southwest' },
        '77072': { city: 'Houston', state: 'TX', available: true, franchise: 'Houston Southwest' },
        '77073': { city: 'Houston', state: 'TX', available: true, franchise: 'Houston North' },
        '77074': { city: 'Houston', state: 'TX', available: true, franchise: 'Houston Southwest' },
        '77075': { city: 'Houston', state: 'TX', available: true, franchise: 'Houston South' },
        '77076': { city: 'Houston', state: 'TX', available: true, franchise: 'Houston Northeast' },
        '77077': { city: 'Houston', state: 'TX', available: true, franchise: 'Houston West' },
        '77078': { city: 'Houston', state: 'TX', available: true, franchise: 'Houston Northeast' },
        '77079': { city: 'Houston', state: 'TX', available: true, franchise: 'Houston West' },
        '77080': { city: 'Houston', state: 'TX', available: true, franchise: 'Houston Northwest' },
        '77081': { city: 'Houston', state: 'TX', available: true, franchise: 'Houston Southwest' },
        '77082': { city: 'Houston', state: 'TX', available: true, franchise: 'Houston West' },
        '77083': { city: 'Houston', state: 'TX', available: true, franchise: 'Houston Southwest' },
        '77084': { city: 'Houston', state: 'TX', available: true, franchise: 'Houston West' },
        '77085': { city: 'Houston', state: 'TX', available: true, franchise: 'Houston South' },
        '77086': { city: 'Houston', state: 'TX', available: true, franchise: 'Houston North' },
        '77087': { city: 'Houston', state: 'TX', available: true, franchise: 'Houston South' },
        '77088': { city: 'Houston', state: 'TX', available: true, franchise: 'Houston North' },
        '77089': { city: 'Houston', state: 'TX', available: true, franchise: 'Houston Southeast' },
        '77090': { city: 'Houston', state: 'TX', available: true, franchise: 'Houston Northwest' },
        '77091': { city: 'Houston', state: 'TX', available: true, franchise: 'Houston Northwest' },
        '77092': { city: 'Houston', state: 'TX', available: true, franchise: 'Houston Northwest' },
        '77093': { city: 'Houston', state: 'TX', available: true, franchise: 'Houston North' },
        '77094': { city: 'Houston', state: 'TX', available: true, franchise: 'Houston West' },
        '77095': { city: 'Houston', state: 'TX', available: true, franchise: 'Houston Northwest' },
        '77096': { city: 'Houston', state: 'TX', available: true, franchise: 'Houston Southwest' },
        '77097': { city: 'Houston', state: 'TX', available: true, franchise: 'Houston Northwest' },
        '77098': { city: 'Houston', state: 'TX', available: true, franchise: 'Houston Central' },
        '77099': { city: 'Houston', state: 'TX', available: true, franchise: 'Houston Southwest' }
      };

      function lookupZip(zipCode) {
        // Clean the input
        var cleanZip = zipCode.replace(/\D/g, '').substring(0, 5);
        
        if (cleanZip.length !== 5) {
          return { error: 'Please enter a valid 5-digit ZIP code' };
        }

        var area = serviceAreas[cleanZip];
        if (area) {
          return {
            success: true,
            zipCode: cleanZip,
            city: area.city,
            state: area.state,
            available: area.available,
            franchise: area.franchise
          };
        } else {
          // For demonstration, use a geocoding API fallback
          return lookupZipWithAPI(cleanZip);
        }
      }

      function lookupZipWithAPI(zipCode) {
        // Using a free geocoding service (no API key required)
        // In production, you might want to use Google Maps API, MapBox, or similar
        return fetch(`https://api.zippopotam.us/us/${zipCode}`)
          .then(response => {
            if (!response.ok) throw new Error('ZIP code not found');
            return response.json();
          })
          .then(data => {
            var city = data.places && data.places[0] ? data.places[0]['place name'] : 'Unknown';
            var state = data.places && data.places[0] ? data.places[0]['state abbreviation'] : 'Unknown';
            
            return {
              success: true,
              zipCode: zipCode,
              city: city,
              state: state,
              available: false, // Not in our service area
              franchise: null
            };
          })
          .catch(() => {
            return { error: 'ZIP code not found. Please check and try again.' };
          });
      }

      function displayResults(result) {
        if (result.error) {
          if (results) {
            results.innerHTML = `
              <div class="zip-error">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
                  <line x1="15" y1="9" x2="9" y2="15" stroke="currentColor" stroke-width="2"/>
                  <line x1="9" y1="9" x2="15" y2="15" stroke="currentColor" stroke-width="2"/>
                </svg>
                <span>${result.error}</span>
              </div>
            `;
          }
          lastZipResult = null;
          setError(result.error);
          if (mapContainer) { 
            mapContainer.classList.remove('is-visible'); 
            mapContainer.style.display = 'none';
            mapContainer.innerHTML = '<div id="zip-map" style="height: 100%; border-radius: 12px; overflow: hidden;"></div>'; 
          }
          if (heroSection) heroSection.classList.remove('map-open');
        } else if (result.success) {
          lastZipResult = result;
          setError('');
          // We no longer render a results card; the map will be shown.
          
          // Show map for successful lookups
          if (mapContainer) {
            mapContainer.classList.add('is-visible');
            mapContainer.style.display = 'block';
            showMapForLocation(result.city, result.state, result.zipCode);
          }
          if (heroSection) heroSection.classList.add('map-open');
        }
        
        // Update visibility
        if (results) {
          var hasContent = (results.innerHTML || '').trim().length > 0;
          results.classList.toggle('is-visible', hasContent);
        }
      }

      function handleSubmit(e) {
        e.preventDefault();
        var zipCode = input.value.trim();
        
        if (!zipCode) {
          displayResults({ error: 'Please enter a ZIP code' });
          return;
        }

        // Show loading state for auto-lookup (real-time display)
        if (results) {
          results.innerHTML = `
            <div class="zip-loading">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 2V6M12 18V22M4.93 4.93L7.76 7.76M16.24 16.24L19.07 19.07M2 12H6M18 12H22M4.93 19.07L7.76 16.24M16.24 7.76L19.07 4.93" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              </svg>
              <span>Looking up ZIP code...</span>
            </div>
          `;
          results.classList.add('is-visible');
        }

        var result = lookupZip(zipCode);
        
        if (result.then) {
          // Handle promise from API call
          result.then(displayResults).catch(() => {
            displayResults({ error: 'Unable to lookup ZIP code. Please try again.' });
          });
        } else {
          // Handle immediate result
          setTimeout(() => displayResults(result), 500); // Small delay for better UX
        }
      }

      // Bind form submission
      form.addEventListener('submit', handleSubmit);

      // Redirect to contact when Search button is clicked, using last lookup if available
      var submitBtn = form.querySelector('button[type="submit"]');
      if (submitBtn) {
        submitBtn.addEventListener('click', function(ev){
          ev.preventDefault();
          var value = (input.value || '').replace(/\D/g, '').substring(0, 5);
          if (value.length !== 5) { displayResults({ error: 'Please enter a valid 5-digit ZIP code' }); return; }
          var url = '/contact?zip=' + value;
          if (lastZipResult && lastZipResult.city) {
            url += '&city=' + encodeURIComponent(lastZipResult.city || '');
            if (lastZipResult.state) url += '&state=' + encodeURIComponent(lastZipResult.state);
          }
          window.location.href = url;
        });
      }

      // Also trigger on input change for better UX
      var debounceTimer;
      input.addEventListener('input', function() {
        clearTimeout(debounceTimer);
        var value = input.value.replace(/\D/g, '').substring(0, 5);
        input.value = value;
        if (clearBtn) clearBtn.classList.toggle('d-none', value.length === 0);
        
        if (value.length === 5) {
          debounceTimer = setTimeout(() => {
            handleSubmit({ preventDefault: () => {} });
          }, 300);
        } else if (results && results.classList.contains('is-visible')) {
          results.innerHTML = '';
          results.classList.remove('is-visible');
          if (mapContainer) { mapContainer.classList.remove('is-visible'); mapContainer.innerHTML = '<div id="zip-map" style="height: 100%; border-radius: 12px; overflow: hidden;"></div>'; }
          lastZipResult = null;
          if (heroSection) heroSection.classList.remove('map-open');
        }
      });

      // Clear results when input is cleared
      input.addEventListener('keydown', function(e) {
        if (e.key === 'Escape' || (e.key === 'Backspace' && input.value.length <= 1)) {
          if (results) { results.innerHTML = ''; results.classList.remove('is-visible'); }
          if (mapContainer) { mapContainer.classList.remove('is-visible'); mapContainer.innerHTML = '<div id="zip-map" style="height: 100%; border-radius: 12px; overflow: hidden;"></div>'; }
          lastZipResult = null;
          if (heroSection) heroSection.classList.remove('map-open');
          if (clearBtn) clearBtn.classList.add('d-none');
        }
      });

      if (clearBtn) {
        clearBtn.addEventListener('click', function(){
          input.value = '';
          input.focus();
          if (results) { results.innerHTML = ''; results.classList.remove('is-visible'); }
          if (mapContainer) { mapContainer.classList.remove('is-visible'); mapContainer.style.display = 'none'; mapContainer.innerHTML = '<div id="zip-map" style="height: 100%; border-radius: 12px; overflow: hidden;"></div>'; }
          lastZipResult = null;
          if (heroSection) heroSection.classList.remove('map-open');
          clearBtn.classList.add('d-none');
        });
      }

      // Google Maps Embed integration (simpler approach)
      window.showMapForLocation = function(city, state, zipCode) {
        var mapElement = document.getElementById('zip-map');
        if (!mapElement) return;
        
        // Use Google Maps Embed API (no API key required for basic usage)
        var query = encodeURIComponent(`${city}, ${state} ${zipCode}`);
        var embedUrl = `https://www.google.com/maps/embed/v1/place?key=YOUR_API_KEY&q=${query}&zoom=12`;
        
        // For demo purposes, use the basic embed without API key
        var basicEmbedUrl = `https://maps.google.com/maps?q=${query}&t=&z=12&ie=UTF8&iwloc=&output=embed`;
        
        mapElement.innerHTML = `
          <iframe
            width="100%"
            height="100%"
            style="border:0; border-radius: 12px; height: 100%;"
            loading="lazy"
            allowfullscreen
            referrerpolicy="no-referrer-when-downgrade"
            src="${basicEmbedUrl}">
          </iframe>
        `;
      };

    } catch(e) { 
      console.error('ZIP lookup error:', e);
    }
  })();
</script>

<script>
  // Add Read more / Show less toggles for long text in blog cards and reviews
  (function(){
    try {
      function clampify(containerSelector, paragraphSelector, clampClass, maxChars){
        var containers = document.querySelectorAll(containerSelector);
        containers.forEach(function(container){
          var ps = container.querySelectorAll(paragraphSelector);
          ps.forEach(function(p){
            // Skip if button already added
            if (p.dataset.processed === 'true') return;
            var text = (p.textContent || '').trim();
            if (text.length <= maxChars) { p.dataset.processed = 'true'; return; }
            p.classList.add(clampClass);
            // Add fade effect if parent allows background
            var parent = p.closest('.entry-summary') || p.parentElement;
            if (parent) parent.classList.add('fade-after');
            var btn = document.createElement('button');
            btn.type = 'button';
            btn.className = 'read-more-btn';
            btn.setAttribute('aria-expanded', 'false');
            btn.textContent = 'Read more';
            btn.addEventListener('click', function(){
              var expanded = btn.getAttribute('aria-expanded') === 'true';
              if (expanded) {
                p.classList.add(clampClass);
                if (parent) parent.classList.add('fade-after');
                btn.setAttribute('aria-expanded', 'false');
                btn.textContent = 'Read more';
              } else {
                p.classList.remove(clampClass);
                if (parent) parent.classList.remove('fade-after');
                btn.setAttribute('aria-expanded', 'true');
                btn.textContent = 'Show less';
              }
            });
            // Insert button after paragraph
            p.insertAdjacentElement('afterend', btn);
            p.dataset.processed = 'true';
          });
        });
      }
      // Blog cards: clamp to ~3 lines / ~160 chars
      clampify('.featured-posts-wrapper', '.entry-summary p', 'clamp-3', 160);
      // Reviews: clamp to ~4 lines / ~240 chars
      clampify('.resi-reviews--inner', '.resi-review--content p', 'clamp-4', 240);
    } catch(e) { /* no-op */ }
  })();
</script>

<div class="scroller-wrapper">
	<div class="content-wrapper">
		<div class="scroller" data-speed="fast" style="color: var(--brand-red)!important; background-color: var(--brand-yellow)!important;">
			<ul class="tag-list scroller__inner">
				<li>
					<div class="h1"><%= (homepage && homepage.scrollerText) || 'Cleaning, Balancing, Repairs, and more' %></div>
				</li>
			</ul>
		</div>
	</div>
</div>

<!-- Page-scoped styles: Scroller marquee (left-to-right) -->
<style>
  .scroller-wrapper { overflow: hidden; }
  .scroller {
    position: relative;
    overflow: hidden;
    white-space: nowrap;
    --scroll-duration: 20s;
  }
  .scroller[data-speed="slow"] { --scroll-duration: 28s; }
  .scroller[data-speed="normal"] { --scroll-duration: 20s; }
  .scroller[data-speed="fast"] { --scroll-duration: 12s; }
  .scroller__inner {
    display: inline-flex;
    align-items: center;
    gap: 2rem;
    will-change: transform;
    padding: 0.5rem 0;
  }
  .scroller .h1 { margin: 0; font-weight: 800; }
  /* With duplicated content, move by 50% for a seamless loop */
  @keyframes marquee-rtl-infinite {
    0% { transform: translateX(0); }
    100% { transform: translateX(-50%); }
  }
  /* Ensure the tag-list has no default margins/padding that could cause jumps */
  .scroller .tag-list { list-style: none; padding: 0; margin: 0; }
  .scroller .tag-list > li { display: inline-flex; }
</style>


<section class="why-choose-us">
	<div class="content-wrapper container">
		<div class="row align-items-center gap-4 gap-lg-0">
			<div class="col-sm-12 col-lg-6 position-relative">
				<div class="image-container">
					<img width="750" height="600" src="<%= (homepage && homepage.whoWeAreImage) || '/wp-content/uploads/2025/08/1756331516002-A9A44F80-33F4-4B58-BD13-6FB384598A18-1-.png' %>" class="img-fluid main-image" alt="Pool maintenance professional at work" decoding="async" fetchpriority="high" />
					
					<!-- Testimonial overlay card -->
					<div class="testimonial-card">
						<blockquote class="testimonial-quote">
							"Consistent, meticulous cleaningsour pool has never looked better."
						</blockquote>
						<div class="testimonial-author">
							<div class="author-avatar">
								<img src="https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=50&h=50&fit=crop&crop=face" alt="Customer photo" />
							</div>
							<div class="author-info">
								<div class="author-name">Mike J.</div>
								<div class="author-location">Dallas, TX</div>
							</div>
						</div>
					</div>
				</div>
			</div>
			
			<div class="col-lg-1 d-none d-lg-block"></div>
			
			<div class="col-lg-5 col-sm-12">
				<div class="section-eyebrow">ABOUT US</div>
				<h2 class="section-title mb-4"><%= (homepage && homepage.whoWeAreTitle) || 'Why choose us?' %></h2>
				<p class="section-description mb-4"><%= (homepage && homepage.whoWeAreBody) || 'At Swim Studs, we deliver professional pool care with certified technicians, reliable service, and transparent communication to keep your pool sparkling year-round.' %></p>
				
				<div class="features-list">
					<div class="feature-item">
						<div class="feature-icon">
							<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
								<path d="M12 2L13.09 8.26L20 9L13.09 9.74L12 16L10.91 9.74L4 9L10.91 8.26L12 2Z" fill="currentColor"/>
							</svg>
						</div>
						<div class="feature-content">
							<h4 class="feature-title">Pool Care Experts</h4>
							<p class="feature-description">Certified technicians with years of experience in pool maintenance and equipment repair.</p>
						</div>
					</div>
					
					<div class="feature-item">
						<div class="feature-icon">
							<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
								<path d="M9 12L11 14L15 10M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
							</svg>
						</div>
						<div class="feature-content">
							<h4 class="feature-title">Reliable Service</h4>
							<p class="feature-description">Consistent weekly cleaning, chemical balancing, and equipment maintenance you can count on.</p>
						</div>
					</div>
				</div>
				
				<button class="btn btn-brand-primary mt-4">Get in touch</button>
			</div>
		</div>
	</div>
</section>

<!-- Page-scoped styles: Why Choose Us section -->
<style>
  .why-choose-us {
    padding: clamp(4rem, 8vw, 6rem) 0;
    background-color: var(--brand-red);
    color: #fff;
  }
  
  .why-choose-us .image-container {
    position: relative;
    border-radius: 20px;
    overflow: hidden;
  }
  
  .why-choose-us .main-image {
    width: 100%;
    height: auto;
    border-radius: 20px;
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.25);
  }
  
  .why-choose-us .testimonial-card {
    position: absolute;
    bottom: 30px;
    left: 30px;
    right: 30px;
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    border-radius: 16px;
    padding: 1.5rem;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
    border: 1px solid rgba(255, 255, 255, 0.2);
  }
  
  .why-choose-us .testimonial-quote {
    font-size: 1rem;
    font-weight: 500;
    color: #333;
    margin: 0 0 1rem 0;
    line-height: 1.4;
    font-style: italic;
  }
  
  .why-choose-us .testimonial-author {
    display: flex;
    align-items: center;
    gap: 0.75rem;
  }
  
  .why-choose-us .author-avatar {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    overflow: hidden;
    flex-shrink: 0;
  }
  
  .why-choose-us .author-avatar img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }
  
  .why-choose-us .author-name {
    font-weight: 600;
    color: #333;
    font-size: 0.9rem;
  }
  
  .why-choose-us .author-location {
    font-size: 0.8rem;
    color: #666;
  }
  
  .why-choose-us .section-eyebrow {
    color: #fff;
    font-size: 0.9rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    margin-bottom: 0.5rem;
  }
  
  .why-choose-us .section-title {
    font-size: clamp(2rem, 4vw, 2.5rem);
    font-weight: 800;
    color: #fff;
    line-height: 1.2;
  }
  
  .why-choose-us .section-description {
    font-size: 1.1rem;
    color: rgba(255,255,255,0.9);
    line-height: 1.6;
  }
  
  .why-choose-us .features-list {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
  }
  
  .why-choose-us .feature-item {
    display: flex;
    align-items: flex-start;
    gap: 1rem;
  }
  
  .why-choose-us .feature-icon {
    width: 48px;
    height: 48px;
    background: rgba(255,255,255,0.15);
    color: #fff;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
  }
  
  .why-choose-us .feature-title {
    font-size: 1.1rem;
    font-weight: 700;
    color: #fff;
    margin: 0 0 0.5rem 0;
  }
  
  .why-choose-us .feature-description {
    font-size: 0.95rem;
    color: rgba(255,255,255,0.9);
    line-height: 1.5;
    margin: 0;
  }
  
  .why-choose-us .btn-brand-primary {
    background-color: #fff !important;
    border-color: #fff !important;
    padding: 0.75rem 1.5rem;
    font-weight: 600;
    border-radius: 8px;
    transition: all 0.3s ease;
    color: var(--brand-red) !important;
  }
  
  .why-choose-us .btn-brand-primary:hover {
    filter: brightness(0.95);
    transform: translateY(-2px);
    color: var(--brand-red) !important;
  }
  
  /* Responsive adjustments */
  @media (max-width: 991.98px) {
    .why-choose-us .image-container {
      margin-bottom: 2rem;
    }
    .why-choose-us .testimonial-card {
      position: static;
      margin-top: 1.5rem;
    }
  }
  
  @media (max-width: 576px) {
    .why-choose-us {
      padding: 3rem 0;
    }
    .why-choose-us .testimonial-card {
      left: 15px;
      right: 15px;
      bottom: 15px;
      padding: 1rem;
    }
    .why-choose-us .feature-item {
      gap: 0.75rem;
    }
    .why-choose-us .feature-icon {
      width: 40px;
      height: 40px;
    }
  }
</style>


<section class="our-services-new">
	<div class="content-wrapper container">
		<!-- Header with title and buttons -->
		<div class="services-header">
			<div class="services-title-section">
				<h2 class="services-main-title"><%= (homepage && homepage.servicesTitle) || 'Explore our wide<br>range of services' %></h2>
			</div>
			<div class="services-header-buttons">
				<a class="btn btn-brand-primary" href="<%= (homepage && homepage.getStartedCtaUrl) || '/contact' %>"><%= (homepage && homepage.getStartedCtaLabel) || 'Get in touch' %></a>
				<a class="btn btn-outline-secondary" href="/services">Browse all services</a>
			</div>
		</div>
		
		<!-- Services grid -->
		<div class="services-grid">
			<% for (let i = 1; i <= 4; i++) { %>
				<% const sTitle = (homepage && homepage[`featuredService${i}Title`]) || `Service ${i}`; %>
				<% const sUrl = (homepage && homepage[`featuredService${i}Url`]) || '/services'; %>
				<% const sImg = (homepage && homepage[`featuredService${i}Image`]) || '/wp-content/uploads/2025/08/1756331571421-A9A44F80-33F4-4B58-BD13-6FB384598A18-1-.png'; %>
				<a class="service-card-new" href="<%= sUrl %>">
					<div class="service-image">
						<img src="<%= sImg %>" alt="<%= sTitle %>" class="img-fluid">
						<div class="service-icon">
							<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
								<path d="M12 2L13.09 8.26L20 9L13.09 9.74L12 16L10.91 9.74L4 9L10.91 8.26L12 2Z" fill="currentColor"/>
							</svg>
						</div>
					</div>
					<div class="service-content">
						<h3 class="service-title"><%= sTitle %></h3>
					</div>
				</a>
			<% } %>
		</div>
		
	</div>
</section>

<!-- Page-scoped styles: New Services Section -->
<style>
  
  .our-services-new .services-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 3rem;
    gap: 2rem;
  }
  
  .our-services-new .services-main-title {
    font-size: clamp(2.5rem, 5vw, 3.5rem);
    font-weight: 800;
    line-height: 1.1;
    color: var(--brand-red);
    margin: 0;
    max-width: 500px;
  }
  
  .our-services-new .services-header-buttons {
    display: flex;
    gap: 1rem;
    flex-shrink: 0;
  }
  
  .our-services-new .btn-brand-primary {
    background-color: var(--brand-red) !important;
    border-color: var(--brand-red) !important;
    padding: 0.75rem 1.5rem;
    font-weight: 600;
    border-radius: 8px;
    transition: all 0.3s ease;
    color: #fff;
  }
  
  .our-services-new .btn-brand-primary:hover {
    filter: brightness(1.05);
    transform: translateY(-2px);
    color: #fff;
  }
  
  .our-services-new .btn-outline-secondary {
    background: transparent;
    border: 2px solid rgba(255, 255, 255, 0.3);
    color: var(--brand-red);
    padding: 0.75rem 1.5rem;
    font-weight: 600;
    border-radius: 8px;
    transition: all 0.3s ease;
  }
  
  .our-services-new .btn-outline-secondary:hover {
    background-color: rgba(255, 255, 255, 0.1);
    border-color: rgba(255, 255, 255, 0.5);
    color: var(--brand-red);
    transform: translateY(-2px);
  }
  
  .our-services-new .services-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr); /* 4 columns on desktop */
    gap: 2rem;
    margin-bottom: 3rem;
    align-items: stretch;
  }
  
  .our-services-new .service-card-new {
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(10px);
    border-radius: 20px;
    overflow: hidden;
    transition: all 0.3s ease;
    border: 1px solid rgba(255, 255, 255, 0.1);
    display: flex;
    flex-direction: column;
    height: 100%;
  }
  
  .our-services-new .service-card-new:hover {
    transform: translateY(-8px);
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
    background: rgba(255, 255, 255, 0.15);
  }
  
  .our-services-new .service-image {
    position: relative;
    height: 320px; /* taller card images */
    overflow: hidden;
  }
  
  .our-services-new .service-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.3s ease;
  }
  
  .our-services-new .service-card-new:hover .service-image img {
    transform: scale(1.05);
  }
  
  .our-services-new .service-icon {
    position: absolute;
    top: 20px;
    left: 20px;
    width: 48px;
    height: 48px;
    background: var(--brand-red);
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #fff;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
  }
  
  .our-services-new .service-content {
    padding: 1.5rem;
  }
  
  .our-services-new .service-title {
    font-size: 1.25rem;
    font-weight: 700;
    color: var(--brand-red);
    margin: 0 0 0.75rem 0;
  }
  
  .our-services-new .service-description {
    font-size: 0.95rem;
    color: var(--brand-red);
    line-height: 1.5;
    margin: 0;
  }
  
  
  .our-services-new .nav-dots {
    display: flex;
    gap: 0.5rem;
  }
  
  .our-services-new .nav-dot {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.3);
    cursor: pointer;
    transition: all 0.3s ease;
  }
  
  .our-services-new .nav-dot.active {
    background: var(--brand-red);
  }
  
  .our-services-new .nav-dot:hover {
    background: rgba(255, 255, 255, 0.5);
  }
  
  /* Responsive adjustments */
  @media (max-width: 1199.98px) {
    .our-services-new .services-grid { grid-template-columns: repeat(3, 1fr); }
  }
  @media (max-width: 991.98px) {
    .our-services-new .services-header {
      flex-direction: column;
      align-items: flex-start;
      gap: 1.5rem;
    }
    
    .our-services-new .services-header-buttons {
      width: 100%;
      justify-content: flex-start;
    }
    
    .our-services-new .services-grid { grid-template-columns: repeat(2, 1fr); gap: 1.5rem; }
    .our-services-new .service-image { height: 260px; }
  }
  
  @media (max-width: 576px) {
    .our-services-new {
      padding: 3rem 0;
    }
    
    .our-services-new .services-header-buttons {
      flex-direction: column;
      width: 100%;
    }
    
    .our-services-new .services-grid { grid-template-columns: 1fr; gap: 1rem; }
    
    .our-services-new .service-image { height: 220px; }
    
    .our-services-new .service-content {
      padding: 1rem;
    }
  }
</style>

<script>
  // Simple button-controlled scrolling for services slider
  (function(){
    try {
      var slider = document.querySelector('.our-services .our-services--slider');
      if (!slider) return;
      var track = slider.querySelector('.our-services--featured');
      var prev = slider.querySelector('.services-nav--prev');
      var next = slider.querySelector('.services-nav--next');
      if (!track || !prev || !next) return;

      function scrollByDir(dir){
        var amount = Math.max(240, Math.min(track.clientWidth * 0.9, 600));
        track.scrollBy({ left: dir * amount, behavior: 'smooth' });
      }
      prev.addEventListener('click', function(){ scrollByDir(-1); });
      next.addEventListener('click', function(){ scrollByDir(1); });

      // Optional: disable buttons at ends (for non-infinite)
      function updateDisabled(){
        var maxScroll = track.scrollWidth - track.clientWidth - 2;
        prev.disabled = track.scrollLeft <= 2;
        next.disabled = track.scrollLeft >= maxScroll;
      }
      track.addEventListener('scroll', updateDisabled);
      window.addEventListener('resize', updateDisabled);
      updateDisabled();
    } catch(e) { /* no-op */ }
  })();
</script>

<!-- Page-scoped styles: Quick Facts brand color overrides -->
<style>
  /* Limit to Quick Facts section */
  .our-stats .our-stats--stat h3,
  .our-stats .our-stats--stat p {
    color: var(--brand-red) !important;
  }
  /* Recolor orange SVGs to brand red within Quick Facts only */
  .our-stats .our-stats--stat--icon img {
    filter: invert(18%) sepia(86%) saturate(4288%) hue-rotate(356deg) brightness(94%) contrast(102%);
  }
  /* Who We Are typography */
  .who-we-are .who-we-are--copy p { margin-bottom: 1.2rem; font-weight: 400; }
  .who-we-are .who-we-are--copy h5 { font-weight: 700; margin-top: 0.5rem; }
</style>

<section class="our-stats stripes-double-top bg-icon bg-icon--right col-sm-12 text-center">
	<div class="content-wrapper container">
		<div class="row">
			<div class="col-sm-12">
				<h2 class="section-title">Pool Facts</h2>
			</div>
		</div>
		<div class="stats-scroller" data-speed="normal">
			<div class="stats-scroller__inner our-stats--stats">
			<div class="our-stats--stat locations"><div class="our-stats--stat--icon"><img width="48" height="62" src="<%= (homepage && homepage.quickLocationsIcon) || '/wp-content/uploads/2025/04/icon-location.svg' %>" class="img-fluid" alt="" decoding="async" /></div><h3 class="gradient"><%= (homepage && homepage.quickLocations) || '1' %></h3><p><%= (homepage && homepage.quickLocationsLabel) || 'LOCATIONS' %></p></div>
			<div class="our-stats--stat jobs-completed"><div class="our-stats--stat--icon"><img width="67" height="62" src="<%= (homepage && homepage.quickJobsIcon) || '/wp-content/uploads/2025/04/icon-jobs.svg' %>" class="img-fluid" alt="" decoding="async" /></div><h3 class="gradient"><%= (homepage && homepage.quickJobs) || '100' %></h3><p><%= (homepage && homepage.quickJobsLabel) || 'JOBS COMPLETED' %></p></div>
			<div class="our-stats--stat states-were-in"><div class="our-stats--stat--icon"><img width="72" height="68" src="<%= (homepage && homepage.quickStatesIcon) || '/wp-content/uploads/2025/04/icon-texas.svg' %>" class="img-fluid" alt="" decoding="async" /></div><h3 class="gradient"><%= (homepage && homepage.quickStates) || '1' %></h3><p><%= (homepage && homepage.quickStatesLabel) || "STATES WE'RE IN" %></p></div>
			<div class="our-stats--stat 5-star-reviews"><div class="our-stats--stat--icon"><img width="213" height="35" src="<%= (homepage && homepage.quickReviewsIcon) || '/wp-content/uploads/2025/04/icon-stars.svg' %>" class="img-fluid" alt="" decoding="async" /></div><h3 class="gradient"><%= (homepage && homepage.quickReviews) || '50' %></h3><p><%= (homepage && homepage.quickReviewsLabel) || '5 STAR REVIEWS' %></p></div>
			<div class="our-stats--stat possibilities"><div class="our-stats--stat--icon"><img width="67" height="65" src="<%= (homepage && homepage.quickEstimatesIcon) || '/wp-content/uploads/2025/04/icon-availability.svg' %>" class="img-fluid" alt="" decoding="async" /></div><h3 class="gradient"><%= (homepage && homepage.quickEstimates) || '24/7' %></h3><p><%= (homepage && homepage.quickEstimatesLabel) || 'ESTIMATES AVAILABLE' %></p></div>
			<div class="our-stats--stat possibilities"><div class="our-stats--stat--icon"><img width="72" height="72" src="<%= (homepage && homepage.quickPossibilitiesIcon) || '/wp-content/uploads/2025/04/icon-check-badge.svg' %>" class="img-fluid" alt="" decoding="async" /></div><h3 class="gradient"><%= (homepage && homepage.quickPossibilities) || 'ENDLESS' %></h3><p><%= (homepage && homepage.quickPossibilitiesLabel) || 'POSSIBILITIES' %></p></div>
			</div>
		</div>
	</div>
</section>

<!-- Page-scoped styles: Pool Facts infinite marquee -->
<style>
  /* Tighten top spacing for the Pool Facts block */
  section.our-stats { padding-top: 0.5rem !important; margin-top: 0 !important; }
  section.our-stats .content-wrapper { padding-top: 0 !important; }
  section.our-stats .section-title { margin-top: 0 !important; margin-bottom: 0.75rem !important; }
  .our-stats .stats-scroller {
    overflow: hidden;
    position: relative;
    --stats-duration: 24s;
  }
  .our-stats .stats-scroller[data-speed="slow"] { --stats-duration: 32s; }
  .our-stats .stats-scroller[data-speed="normal"] { --stats-duration: 24s; }
  .our-stats .stats-scroller[data-speed="fast"] { --stats-duration: 16s; }

  .our-stats .stats-scroller__inner {
    display: flex;
    flex-wrap: nowrap;
    align-items: stretch;
    gap: 1rem;
    white-space: nowrap;
    will-change: transform;
    animation: stats-marquee-rtl var(--stats-duration) linear infinite;
  }


  /* Ensure each stat lays out horizontally without wrapping weird bootstrap row margins */
  .our-stats .our-stats--stats { margin-left: 0; margin-right: 0; }
  .our-stats .our-stats--stat { display: inline-flex; flex-direction: column; align-items: center; padding: 0 0.25rem; flex: 0 0 auto; }

  /* Seamless loop: translate by half after duplication */
  @keyframes stats-marquee-rtl {
    0% { transform: translateX(0); }
    100% { transform: translateX(-50%); }
  }

</style>

<script>
  (function(){
    try {
      var wrap = document.querySelector('.our-stats .stats-scroller');
      if (!wrap) return;
      var inner = wrap.querySelector('.stats-scroller__inner');
      if (!inner) return;
      if (inner.dataset.duplicated === 'true') return;
      inner.innerHTML = inner.innerHTML + inner.innerHTML;
      inner.dataset.duplicated = 'true';
    } catch (e) { /* no-op */ }
  })();
</script>

<section class="blogFeat blogFeat-wrapper col-sm-12">
	<div class="content-wrapper container">
		<h4><%= (homepage && homepage.blogKicker) || 'CHECK OUT WHAT THE PROS HAVE TO SAY' %></h4>
		<h2 class="section-title"><%= (homepage && homepage.blogTitle) || 'SEE WHY WERE THE EXPERTS' %></h2>
		<div class="blogContent blogContent-wrapper">
			<div class="blogCards blogCards-wrapper col-sm-12">
				<div class="container blog-split justify-content-center">
					<div class="blog-slider">
					  <button class="blog-nav blog-nav--prev" type="button" aria-label="Previous posts"></button>
					  <div class="featured-posts-wrapper" role="region" aria-label="Featured blog posts slider">
							<% 
							  const posts = [];
							  for (let i = 1; i <= 3; i++) {
							    const pt = homepage && homepage[`blogFeat${i}Title`];
							    const pu = homepage && homepage[`blogFeat${i}Url`];
							    const pi = homepage && homepage[`blogFeat${i}Image`];
							    const pe = homepage && homepage[`blogFeat${i}Excerpt`];
							    if (pt && pu && pi) posts.push({ title: pt, url: pu, image: pi, excerpt: pe || '' });
							  }
							%>
							  <% posts.forEach(function(p){ %>
							    <a href="<%= p.url %>" class="feat-post">
							    	<article class="post type-post status-publish format-standard has-post-thumbnail hentry category-uncategorized">
							    		<div class="post-thumbnail"><img width="800" height="600" src="<%= p.image %>" class="attachment-post-thumbnail size-post-thumbnail" alt="" decoding="async" /></div>
							    		<div class="entry-summary"><h6 class="entry-title"><%= p.title %></h6><% if (p.excerpt) { %><p><%= p.excerpt %></p><% } %></div>
							    	</article></a>
							  <% }) %>
						</div>
					  <button class="blog-nav blog-nav--next" type="button" aria-label="Next posts"></button>
					</div>
					            <aside class="featured-post-detail" aria-live="polite" aria-atomic="true" hidden>
              <div class="detail-card">
                <div class="detail-thumb">
                  <img src="" alt="" class="img-fluid" />
                </div>
                <div class="detail-body">
                <h3 class="detail-title"></h3>
                <p class="detail-excerpt clamp-4"></p>
                <div class="detail-actions">
                  <a class="btn btn-primary-dark detail-read" href="#" target="">Read full post</a>
                </div>
              </div>
            </div>
          </aside>
				</div>
			</div>
			<div class="text-center">
				<a href="/blog/index.html" class="btn btn-primary btn-lg">All Posts</a>
			</div>
		</div>
	</div>
  </section>

  <script>
  // Blog detail panel interaction: populate right-side panel from clicked card
  (function(){
    try {
      var split = document.querySelector('.blog-split');
      if (!split) return;
      var cards = split.querySelectorAll('.featured-posts-wrapper a.feat-post');
      var panel = split.querySelector('.featured-post-detail');
      if (!cards.length || !panel) return;

      var imgEl = panel.querySelector('.detail-thumb img');
      var titleEl = panel.querySelector('.detail-title');
      var excerptEl = panel.querySelector('.detail-excerpt');
      var linkEl = panel.querySelector('.detail-read');

      function slugifyTitle(s) {
        return String(s || '')
          .toLowerCase()
          .replace(/&/g, ' and ')
          .replace(/[^a-z0-9]+/g, '-')
          .replace(/^-+|-+$/g, '')
          .substring(0, 120);
      }

      function activateFromCard(card) {
        // Extract data
        var img = card.querySelector('.post-thumbnail img');
        var title = card.querySelector('.entry-title');
        var excerpt = card.querySelector('.entry-summary p');
        // Populate panel
        if (img && imgEl) {
          imgEl.src = img.getAttribute('src') || '';
          imgEl.alt = (title && title.textContent) ? title.textContent : '';
        }
        if (titleEl) titleEl.textContent = title ? title.textContent : '';
        if (excerptEl) {
          excerptEl.textContent = excerpt ? excerpt.textContent : '';
          excerptEl.classList.remove('clamp-4'); // Ensure expanded in panel
          var parent = excerptEl.parentElement;
          if (parent) parent.classList.remove('fade-after');
        }
        if (linkEl) {
          var slug = slugifyTitle(title ? title.textContent : '');
          linkEl.setAttribute('href', slug ? ('/blog/' + slug) : '/blog');
        }

        // Visual active state
        cards.forEach(function(c){ c.classList.remove('is-active'); });
        card.classList.add('is-active');
        // Reveal panel and switch layout
        panel.hidden = false;
        split.classList.add('show-detail');
      }

      // Bind click handlers
      cards.forEach(function(card){
        card.addEventListener('click', function(e){
          if (e.metaKey || e.ctrlKey) return; // allow open in new tab
          e.preventDefault();
          if (card.classList.contains('is-active')) {
            // Toggle off if clicking the active card
            card.classList.remove('is-active');
            panel.hidden = true;
            split.classList.remove('show-detail');
            return;
          }
          activateFromCard(card);
          // Scroll into view on small screens
          if (window.matchMedia('(max-width: 768px)').matches) {
            panel.scrollIntoView({ behavior: 'smooth', block: 'start' });
          }
        });
      });

      // Close when clicking outside the blog-split area
      document.addEventListener('click', function(e){
        try {
          var within = split.contains(e.target);
          if (!within) {
            cards.forEach(function(c){ c.classList.remove('is-active'); });
            panel.hidden = true;
            split.classList.remove('show-detail');
          }
        } catch(_) {}
      });

      // Close on Escape key
      document.addEventListener('keydown', function(e){
        if (e.key === 'Escape') {
          cards.forEach(function(c){ c.classList.remove('is-active'); });
          panel.hidden = true;
          split.classList.remove('show-detail');
        }
      });
    } catch(e) { /* no-op */ }
  })();
</script>



<!-- Page-scoped styles: Review cards brand styling -->
<style>
  /* Only the individual review cards, not the whole section */
  #reviews .resi-review .resi-review--inner {
    background-color: var(--brand-red) !important;
    color: #fff !important;
    border-color: var(--brand-red) !important;
  }
  #reviews .resi-review .resi-review--inner .resi-review--stars,
  #reviews .resi-review .resi-review--inner .resi-review--content,
  #reviews .resi-review .resi-review--inner .resi-review--content p,
  #reviews .resi-review .resi-review--inner .resi-review--author,
  #reviews .resi-review .resi-review--inner h5,
  #reviews .resi-review .resi-review--inner p {
    color: #fff !important;
  }
  #reviews .resi-review .resi-review--inner a {
    color: #fff !important;
    border-color: rgba(255,255,255,0.5) !important;
  }
  /* Make stars bigger, brand-yellow, and position them at the bottom */
  #reviews .resi-review .resi-review--inner { display: flex; flex-direction: column; gap: 0.5rem; }
  #reviews .resi-review .resi-review--inner .resi-review--stars {
    order: 3;
    color: var(--brand-yellow) !important;
    font-size: 1.75rem !important;
    letter-spacing: 0.08em;
    margin-top: 0.25rem;
  }
  #reviews .resi-review .resi-review--inner .resi-review--content { order: 1; }
  #reviews .resi-review .resi-review--inner .resi-review--meta { order: 2; }
</style>

<%- include('partials/get-started', {
  title: (homepage && homepage.getStartedTitle) || 'Ready to get started?',
  body: (homepage && homepage.getStartedBody) || 'Contact us for a free onsite estimate within 24 hours.',
  url: (homepage && homepage.getStartedCtaUrl) || '/contact',
  label: (homepage && homepage.getStartedCtaLabel) || 'Contact Us'
}) %>

<section id="reviews" class="reviews reviews-wrapper">
	<div class="container">
		<section class="resi-reviews">
			<div class="container">
				<div class="resi-reviews--inner">
					<% 
					  const reviews = [];
					  for (let i = 1; i <= 3; i++) {
					    const text = homepage && homepage[`review${i}Text`];
					    const author = homepage && homepage[`review${i}Author`];
					    if (text && author) reviews.push({ text, author });
					  }
					%>
					<% reviews.forEach(function(r){ %>
					  <div class="resi-review"><div class="resi-review--inner"><div class="resi-review--stars"></div><div class="resi-review--content check-overflow"><div class="resi-review--content--inner"><p><%= r.text %></p></div></div><div class="resi-review--meta"><h5 class="resi-review--author"><%= r.author %></h5></div></div></div>
					<% }); %>
				</div>
			</div>
		</section>
	</div>
</section>

<script>
  (function () {
    try {
      var hero = document.querySelector('section.hero.hero-wrapper.overlay-jade');
      if (hero) {
        var bg = hero.getAttribute('data-hero-bg');
        if (bg) {
          hero.style.backgroundImage = 'url(' + JSON.stringify(bg) + ')';
          hero.style.backgroundRepeat = 'no-repeat';
          hero.style.backgroundSize = 'cover';
          hero.style.backgroundPosition = 'center';
        }
      }
    } catch (e) { /* no-op */ }
  })();
  </script>

<!-- ZIP capture modal (shown when user clicks Contact/Get Free Estimate) -->
<div id="zip-modal-backdrop" class="zip-modal-backdrop" aria-hidden="true">
  <div class="zip-modal" role="dialog" aria-modal="true" aria-labelledby="zip-modal-title">
    <header id="zip-modal-title">Enter your ZIP code</header>
    <div class="body">
      <div class="zip-input-group">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><path d="M10 2a8 8 0 1 1 0 16 8 8 0 0 1 0-16Zm11 20-6-6" stroke="#888" stroke-width="2" stroke-linecap="round"/></svg>
        <input type="text" id="zip-modal-input" inputmode="numeric" maxlength="5" placeholder="12345" autocomplete="postal-code" aria-label="ZIP code" />
      </div>
      <div id="zip-suggest-modal" class="zip-suggest-modal" role="listbox" aria-label="ZIP suggestions"></div>
      <div id="zip-hint" style="margin-top:.5rem; font-size:.9rem; color:#666;"></div>
    </div>
    <div class="actions">
      <button type="button" class="btn-cancel" id="zip-cancel">Cancel</button>
      <button type="button" class="btn-continue" id="zip-continue">Continue</button>
    </div>
  </div>
  </div>

<script>
  // ZIP modal: intercept /contact CTAs, show modal, lookup ZIP -> redirect with city/state
  (function(){
    try {
      var backdrop = document.getElementById('zip-modal-backdrop');
      if (!backdrop) return; // safety
      var input = backdrop.querySelector('#zip-modal-input');
      var suggest = backdrop.querySelector('#zip-suggest-modal');
      var hint = backdrop.querySelector('#zip-hint');
      var btnCancel = backdrop.querySelector('#zip-cancel');
      var btnGo = backdrop.querySelector('#zip-continue');
      var selected = null;

      // Provide a US serviceAreas map for richer suggestions (fallback if none provided elsewhere)
      var serviceAreas = window.__zipServiceAreas || {
        '78701': { city: 'Austin', state: 'TX' },
        '78702': { city: 'Austin', state: 'TX' },
        '78703': { city: 'Austin', state: 'TX' },
        '78704': { city: 'Austin', state: 'TX' },
        '78705': { city: 'Austin', state: 'TX' },
        '78731': { city: 'Austin', state: 'TX' },
        '78732': { city: 'Austin', state: 'TX' },
        '78733': { city: 'Austin', state: 'TX' },
        '78734': { city: 'Austin', state: 'TX' },
        '78735': { city: 'Austin', state: 'TX' },
        '78736': { city: 'Austin', state: 'TX' },
        '78737': { city: 'Austin', state: 'TX' },
        '78738': { city: 'Austin', state: 'TX' },
        '78739': { city: 'Austin', state: 'TX' },
        '78741': { city: 'Austin', state: 'TX' },
        '78742': { city: 'Austin', state: 'TX' },
        '78744': { city: 'Austin', state: 'TX' },
        '78745': { city: 'Austin', state: 'TX' },
        '78746': { city: 'Austin', state: 'TX' },
        '78747': { city: 'Austin', state: 'TX' },
        '78748': { city: 'Austin', state: 'TX' },
        '78749': { city: 'Austin', state: 'TX' },
        '78750': { city: 'Austin', state: 'TX' },
        '78751': { city: 'Austin', state: 'TX' },
        '78752': { city: 'Austin', state: 'TX' },
        '78753': { city: 'Austin', state: 'TX' },
        '78754': { city: 'Austin', state: 'TX' },
        '78756': { city: 'Austin', state: 'TX' },
        '78757': { city: 'Austin', state: 'TX' },
        '78758': { city: 'Austin', state: 'TX' },
        '78759': { city: 'Austin', state: 'TX' }
      };

      function hideSuggest(){ if (suggest){ suggest.style.display='none'; suggest.innerHTML=''; } }
      function showLoading(){
        if (!suggest) return;
        suggest.innerHTML = '<div class="item" aria-live="polite"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><circle cx="12" cy="12" r="9" stroke="currentColor" stroke-width="2" opacity=".35"/><path d="M21 12a9 9 0 0 1-9 9" stroke="currentColor" stroke-width="2"/></svg> Searching</div>';
        suggest.style.display = 'block';
      }
      function showSuggest(items){
        if (!suggest) return;
        suggest.innerHTML = '';
        if (!items || !items.length) {
          var empty = document.createElement('div');
          empty.className = 'item';
          empty.textContent = 'No results found';
          suggest.appendChild(empty);
          suggest.style.display = 'block';
          return;
        }
        items.forEach(function(item){
          var div = document.createElement('div');
          div.className = 'item';
          div.innerHTML = '<svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><path d="M12 2C8.14 2 5 5.14 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.86-3.14-7-7-7Zm0 9.5a2.5 2.5 0 1 1 0-5 2.5 2.5 0 0 1 0 5Z" fill="currentColor"/></svg> ' + item.label;
          div.addEventListener('click', function(){ selected = item; hint.textContent = item.label; hideSuggest(); });
          suggest.appendChild(div);
        });
        suggest.style.display = 'block';
      }
      function formatLabel(zip, area){
        var city = (area && area.city) || '';
        var state = (area && area.state) || '';
        if (city && state) return city + ', ' + state + ' ' + zip + ', USA';
        return zip + ', USA';
      }
      function buildSuggestionsFromPrefix(prefix){
        var out = [];
        var n = 0;
        Object.keys(serviceAreas).sort().forEach(function(zip){
          if (zip.indexOf(prefix) === 0 && n < 8){ out.push({ zip: zip, city: serviceAreas[zip].city, state: serviceAreas[zip].state, label: formatLabel(zip, serviceAreas[zip]) }); n++; }
        });
        return out;
      }
      function buildRelatedSuggestions(exactZip){
        var area = serviceAreas[exactZip];
        var list = [];
        if (area) list.push({ zip: exactZip, city: area.city, state: area.state, label: formatLabel(exactZip, area) });
        // same city/state first
        Object.keys(serviceAreas).forEach(function(z){
          if (z !== exactZip){ var a = serviceAreas[z]; if (a && area && a.city === area.city && a.state === area.state){ list.push({ zip:z, city:a.city, state:a.state, label: formatLabel(z,a) }); } }
        });
        // fallback more by prefix if needed
        var base3 = exactZip.substring(0,3);
        if (list.length < 6){
          Object.keys(serviceAreas).forEach(function(z){
            if (list.length >= 8) return;
            if (z !== exactZip && z.substring(0,3) === base3){ list.push({ zip:z, city:serviceAreas[z].city, state:serviceAreas[z].state, label: formatLabel(z, serviceAreas[z]) }); }
          });
        }
        // unique by zip & cap 8
        var seen = {};
        var out = [];
        for (var i=0; i<list.length && out.length<8; i++){ if (!seen[list[i].zip]){ seen[list[i].zip]=1; out.push(list[i]); } }
        return out;
      }
      function show(){ backdrop.style.display='flex'; selected=null; input.value=''; hint.textContent=''; hideSuggest(); setTimeout(function(){ input.focus(); }, 30); }
      function hide(){ backdrop.style.display='none'; }
      function lookup(zip){
        var z = String(zip||'').replace(/\D/g,'').slice(0,5);
        if (z.length !== 5) { hideSuggest(); selected=null; return; }
        // Prefer related suggestions from our local service map for richer results
        var local = buildRelatedSuggestions(z);
        if (local && local.length){ selected = local[0]; showSuggest(local); return; }
        // Fallback to API when local data is not available
        showLoading();
        fetch('https://api.zippopotam.us/us/' + z)
          .then(function(r){ if(!r.ok) throw new Error('nf'); return r.json(); })
          .then(function(data){
            var places = Array.isArray(data.places) ? data.places : [];
            var items = places.map(function(p){
              var city = p['place name'] || '';
              var state = p['state abbreviation'] || '';
              var label = (city && state) ? (city + ', ' + state + ' ' + z + ', USA') : (z + ', USA');
              return { zip:z, city:city, state:state, label:label };
            });
            if (!items.length) items = [{ zip:z, city:'', state:'', label: z + ', USA' }];
            selected = items[0];
            showSuggest(items);
          })
          .catch(function(){ hideSuggest(); selected=null; });
      }

      var t;
      input && input.addEventListener('input', function(){
        var v = input.value.replace(/\D/g,'').slice(0,5); input.value = v;
        clearTimeout(t);
        if (v.length >= 3 && v.length < 5){
          var pref = buildSuggestionsFromPrefix(v);
          if (pref.length){ showSuggest(pref); } else { hideSuggest(); }
          return;
        }
        if (v.length < 5){ hideSuggest(); return; }
        t = setTimeout(function(){ lookup(v); }, 150);
      });
      input && input.addEventListener('blur', function(){ setTimeout(hideSuggest, 150); });
      btnCancel && btnCancel.addEventListener('click', hide);
      btnGo && btnGo.addEventListener('click', function(){
        var v = (selected && selected.zip) || (input.value||'').replace(/\D/g,'').slice(0,5);
        if (v.length !== 5) { hint.textContent = 'Please enter a valid 5-digit ZIP'; return; }
        var url = '/contact-us?zip=' + v;
        if (selected){ if (selected.city) url += '&city=' + encodeURIComponent(selected.city); if (selected.state) url += '&state=' + encodeURIComponent(selected.state); }
        window.location.href = url;
      });

      // Global delegation so any /contact link triggers the modal (header, footer, hero, etc.)
      if (!window.__zipModalDelegated) {
        window.__zipModalDelegated = true;
        document.addEventListener('click', function(ev){
          var el = ev.target && ev.target.closest ? ev.target.closest('a,button,[data-bs-target]') : null;
          if (!el) return;
          var href = el.getAttribute('href') || '';
          var target = el.getAttribute('data-bs-target') || '';
          // match: /contact, contact, absolute http(s)://.../contact
          var isContact = /(^|\b|\/)contact(\b|\/?|\?|#)/i.test(href);
          var isScheduleModal = target === '#scheduleModal';
          if (isContact || isScheduleModal) {
            ev.preventDefault();
            ev.stopImmediatePropagation();
            console.debug('[ZIP] Intercepted CTA', { href: href, target: target });
            show();
          }
        }, true);
      }

      // Close on backdrop click or ESC
      backdrop.addEventListener('click', function(e){ if (e.target === backdrop) hide(); });
      document.addEventListener('keydown', function(e){ if (backdrop.style.display==='flex' && e.key==='Escape') hide(); });

      // Test harness: enable with ?ziptest=1, or use window.showZipModal()
      window.showZipModal = show;
      try {
        var qp = new URLSearchParams(window.location.search);
        if (qp.get('ziptest') === '1') {
          var btn = document.createElement('button');
          btn.textContent = 'Open ZIP Modal (TEST)';
          btn.style.position = 'fixed';
          btn.style.right = '12px';
          btn.style.bottom = '12px';
          btn.style.zIndex = '2000';
          btn.style.padding = '.5rem .75rem';
          btn.style.borderRadius = '8px';
          btn.style.border = '1px solid rgba(0,0,0,.15)';
          btn.style.background = '#fff';
          btn.style.color = '#05132D';
          btn.addEventListener('click', show);
          document.body.appendChild(btn);
          console.debug('[ZIP] Test harness enabled');
        }
      } catch(_){}
    } catch(e) { /* no-op */ }
  })();
  // Simple button-controlled scrolling for blog slider
  (function(){
    try {
      var slider = document.querySelector('.blogFeat .blog-slider');
      if (!slider) return;
      var track = slider.querySelector('.featured-posts-wrapper');
      var prev = slider.querySelector('.blog-nav--prev');
      var next = slider.querySelector('.blog-nav--next');
      if (!track || !prev || !next) return;

      function scrollByDir(dir){
        var amount = Math.max(240, Math.min(track.clientWidth * 0.9, 600));
        track.scrollBy({ left: dir * amount, behavior: 'smooth' });
      }
      prev.addEventListener('click', function(){ scrollByDir(-1); });
      next.addEventListener('click', function(){ scrollByDir(1); });

      function updateDisabled(){
        var maxScroll = track.scrollWidth - track.clientWidth - 2;
        prev.disabled = track.scrollLeft <= 2;
        next.disabled = track.scrollLeft >= maxScroll;
      }
      track.addEventListener('scroll', updateDisabled);
      window.addEventListener('resize', updateDisabled);
      updateDisabled();
    } catch(e) { /* no-op */ }
  })();
  </script>
<%- include('partials/footer') %>
